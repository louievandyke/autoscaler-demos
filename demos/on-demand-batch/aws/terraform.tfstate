{
  "version": 4,
  "terraform_version": "0.13.4",
  "serial": 45,
  "lineage": "1d38f0ce-333c-67fd-471e-735bb0395654",
  "outputs": {
    "detail": {
      "value": "\nServer IPs:\n * instance set-squirrel-server-1 - Public: 18.212.227.141, Private: 172.31.20.34\n\nThe Nomad UI can be accessed at http://set-squirrel-servers-1026535637.us-east-1.elb.amazonaws.com:4646/ui\nThe Consul UI can be accessed at http://set-squirrel-servers-1026535637.us-east-1.elb.amazonaws.com:8500/ui\nGrafana dashboard can be accessed at http://set-squirrel-platform-1400111000.us-east-1.elb.amazonaws.com:3000/d/CJlc3r_Mk/on-demand-batch-job-demo?orgId=1\u0026refresh=5s\nTraefik can be accessed at http://set-squirrel-platform-1400111000.us-east-1.elb.amazonaws.com:8081\nPrometheus can be accessed at http://set-squirrel-platform-1400111000.us-east-1.elb.amazonaws.com:9090\n\nCLI environment variables:\nexport NOMAD_ADDR=http://set-squirrel-servers-1026535637.us-east-1.elb.amazonaws.com:4646\n",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "http",
      "name": "my_ip",
      "provider": "provider[\"registry.terraform.io/hashicorp/http\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "body": "72.197.144.63\n",
            "id": "https://icanhazip.com/",
            "request_headers": null,
            "response_headers": {
              "Access-Control-Allow-Methods": "GET",
              "Access-Control-Allow-Origin": "*",
              "Alt-Svc": "h3-27=\":443\"; ma=86400, h3-28=\":443\"; ma=86400, h3-29=\":443\"; ma=86400, h3=\":443\"; ma=86400",
              "Cf-Ray": "6685cf6f9913d372-LAX",
              "Content-Length": "14",
              "Content-Type": "text/plain",
              "Date": "Fri, 02 Jul 2021 06:27:47 GMT",
              "Expect-Ct": "max-age=604800, report-uri=\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\"",
              "Server": "cloudflare",
              "Set-Cookie": "__cf_bm=f40ad51930c21bada5280d7d978173420e0327a3-1625207267-1800-AYHcHoDWoyzuaT8TrbE0LdBtt0UIxb2LU64Mns9GgKQ6VHIZpg57xBzS+fk8jR58NFZoyavB32/Ph8TiKjlhHKU=; path=/; expires=Fri, 02-Jul-21 06:57:47 GMT; domain=.icanhazip.com; HttpOnly; Secure; SameSite=None",
              "Vary": "Accept-Encoding"
            },
            "url": "https://icanhazip.com/"
          }
        }
      ]
    },
    {
      "mode": "managed",
      "type": "nomad_job",
      "name": "autoscaler",
      "provider": "provider[\"registry.terraform.io/hashicorp/nomad\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allocation_ids": [
              "7a247f9d-9f07-7933-037f-c6294f5d9a46"
            ],
            "datacenters": [
              "dc1"
            ],
            "deployment_id": null,
            "deployment_status": null,
            "deregister_on_destroy": true,
            "deregister_on_id_change": true,
            "detach": true,
            "hcl2": [],
            "id": "autoscaler",
            "jobspec": "job \"autoscaler\" {\n  datacenters = [\"dc1\"]\n\n  constraint {\n    attribute = \"${node.class}\"\n    value     = \"platform\"\n  }\n\n  group \"autoscaler\" {\n    network {\n      port \"autoscaler\" {}\n      port \"promtail\" {}\n    }\n\n    task \"autoscaler\" {\n      driver = \"docker\"\n\n      config {\n        image   = \"hashicorp/nomad-autoscaler:0.3.2\"\n        command = \"nomad-autoscaler\"\n        args    = [\"agent\", \"-config\", \"local/config.hcl\"]\n        ports   = [\"autoscaler\"]\n      }\n\n      template {\n        data = \u003c\u003cEOF\nhttp {\n  bind_address = \"0.0.0.0\"\n  bind_port    = {{ env \"NOMAD_PORT_autoscaler\" }}\n}\n\npolicy {\n  dir = \"local/policies\"\n}\n\nnomad {\n  address = \"http://{{env \"attr.unique.network.ip-address\" }}:4646\"\n}\n\napm \"prometheus\" {\n  driver = \"prometheus\"\n  config = {\n    address = \"http://{{ range service \"prometheus\" }}{{ .Address }}:{{ .Port }}{{ end }}\"\n  }\n}\n\ntarget \"aws-asg\" {\n  driver = \"aws-asg\"\n  config = {\n    aws_region = \"us-east-1\"\n  }\n}\n\nstrategy \"pass-through\" {\n  driver = \"pass-through\"\n}\nEOF\n\n        change_mode   = \"signal\"\n        change_signal = \"SIGHUP\"\n        destination   = \"local/config.hcl\"\n      }\n\n      template {\n        data = \u003c\u003cEOF\nscaling \"batch\" {\n  enabled = true\n  min     = 0\n  max     = 5\n\n  policy {\n    cooldown            = \"1m\"\n    evaluation_interval = \"10s\"\n\n    check \"batch_jobs_in_progess\" {\n      source = \"prometheus\"\n      query  = \"sum(nomad_nomad_job_summary_queued{exported_job=~\\\"batch/.*\\\"} + nomad_nomad_job_summary_running{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\"\n\n      strategy \"pass-through\" {}\n    }\n\n    target \"aws-asg\" {\n      aws_asg_name           = \"set-squirrel-batch20210702063839077800000013\"\n      node_class             = \"batch\"\n      node_drain_deadline    = \"1h\"\n      node_selector_strategy = \"empty_ignore_system\"\n    }\n  }\n}\nEOF\n\n        change_mode   = \"signal\"\n        change_signal = \"SIGHUP\"\n        destination   = \"local/policies/batch.hcl\"\n      }\n\n      service {\n        name = \"autoscaler\"\n        port = \"autoscaler\"\n\n        check {\n          type     = \"http\"\n          path     = \"/v1/health\"\n          interval = \"10s\"\n          timeout  = \"2s\"\n        }\n      }\n    }\n\n    task \"promtail\" {\n      driver = \"docker\"\n\n      lifecycle {\n        hook    = \"prestart\"\n        sidecar = true\n      }\n\n      config {\n        image = \"grafana/promtail:1.5.0\"\n        ports = [\"promtail\"]\n\n        args = [\n          \"-config.file\",\n          \"local/promtail.yaml\",\n        ]\n      }\n\n      template {\n        data = \u003c\u003cEOH\nserver:\n  http_listen_port: {{ env \"NOMAD_PORT_promtail\" }}\n  grpc_listen_port: 0\n\npositions:\n  filename: /tmp/positions.yaml\n\nclient:\n  url: http://{{ range $i, $s := service \"loki\" }}{{ if eq $i 0 }}{{.Address}}:{{.Port}}{{end}}{{end}}/api/prom/push\n\nscrape_configs:\n- job_name: system\n  entry_parser: raw\n  static_configs:\n  - targets:\n      - localhost\n    labels:\n      task: autoscaler\n      __path__: {{ env \"NOMAD_ALLOC_DIR\" }}/logs/autoscaler*\n  pipeline_stages:\n  - match:\n      selector: '{task=\"autoscaler\"}'\n      stages:\n      - regex:\n          expression: '.*policy_id=(?P\u003cpolicy_id\u003e[a-zA-Z0-9_-]+).*reason=\"(?P\u003creason\u003e.+)\"'\n      - labels:\n          policy_id:\n          reason:\nEOH\n\n        destination = \"local/promtail.yaml\"\n      }\n\n      resources {\n        cpu    = 50\n        memory = 32\n      }\n\n      service {\n        name = \"promtail\"\n        port = \"promtail\"\n\n        check {\n          type     = \"http\"\n          path     = \"/ready\"\n          interval = \"10s\"\n          timeout  = \"2s\"\n        }\n      }\n    }\n  }\n}\n",
            "json": null,
            "modify_index": "23",
            "name": "autoscaler",
            "namespace": "default",
            "policy_override": null,
            "purge_on_destroy": null,
            "region": "global",
            "task_groups": [
              {
                "count": 1,
                "meta": {},
                "name": "autoscaler",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "autoscaler",
                    "volume_mounts": null
                  },
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "promtail",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              }
            ],
            "timeouts": null,
            "type": "service"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsInVwZGF0ZSI6MzAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.http.my_ip",
            "module.clients_batch.aws_autoscaling_group.clients",
            "module.clients_batch.aws_iam_instance_profile.clients",
            "module.clients_batch.aws_iam_role.clients",
            "module.clients_batch.aws_launch_template.clients",
            "module.clients_batch.data.aws_iam_policy_document.assume_role",
            "module.clients_batch.data.template_file.user_data",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_elb.servers",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "module.nomad_jobs.data.local_file.grafana_dashboard",
            "module.nomad_jobs.nomad_job.batch",
            "module.nomad_jobs.nomad_job.grafana",
            "module.nomad_jobs.nomad_job.prometheus",
            "module.nomad_jobs.nomad_job.traefik",
            "module.nomad_jobs.null_resource.wait_for_nomad_api",
            "module.servers.aws_iam_instance_profile.servers",
            "module.servers.aws_iam_role.servers",
            "module.servers.aws_instance.servers",
            "module.servers.data.aws_iam_policy_document.assume",
            "module.servers.data.template_file.user_data",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "null_resource",
      "name": "preflight_check",
      "provider": "provider[\"registry.terraform.io/hashicorp/null\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "8635232179667273678",
            "triggers": null
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "random_pet",
      "name": "stack_name",
      "provider": "provider[\"registry.terraform.io/hashicorp/random\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "set-squirrel",
            "keepers": null,
            "length": 2,
            "prefix": null,
            "separator": "-"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "module": "module.clients_batch",
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "assume_role",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "1903849331",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "sts:AssumeRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "ec2.amazonaws.com"
                    ],
                    "type": "Service"
                  }
                ],
                "resources": [],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "module": "module.clients_batch",
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "1474532532",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:DescribeInstances\",\n        \"autoscaling:UpdateAutoScalingGroup\",\n        \"autoscaling:TerminateInstanceInAutoScalingGroup\",\n        \"autoscaling:DescribeScalingActivities\",\n        \"autoscaling:DescribeAutoScalingGroups\",\n        \"autoscaling:CreateOrUpdateTags\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "autoscaling:CreateOrUpdateTags",
                  "autoscaling:DescribeAutoScalingGroups",
                  "autoscaling:DescribeScalingActivities",
                  "autoscaling:TerminateInstanceInAutoScalingGroup",
                  "autoscaling:UpdateAutoScalingGroup",
                  "ec2:DescribeInstances"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "*"
                ],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "module": "module.clients_batch",
      "mode": "data",
      "type": "template_file",
      "name": "user_data",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "4b4ecc9b52b2f1fe6b8a23c53dd4f207019ea5ad96c01ed13fcfbf595c454dec",
            "rendered": "#!/bin/bash\n\nset -e\n\nexec \u003e \u003e(sudo tee /var/log/user-data.log|logger -t user-data -s 2\u003e/dev/console) 2\u003e\u00261\nsudo chmod +x /ops/scripts/client.sh\nsudo bash -c \"NOMAD_BINARY= CONSUL_BINARY=  /ops/scripts/client.sh \\\"aws\\\" \\\"provider=aws tag_key=ConsulAutoJoin tag_value=auto-join\\\" \\\"batch\\\"\"\nrm -rf /ops/\n",
            "template": "#!/bin/bash\n\nset -e\n\nexec \u003e \u003e(sudo tee /var/log/user-data.log|logger -t user-data -s 2\u003e/dev/console) 2\u003e\u00261\nsudo chmod +x /ops/scripts/client.sh\nsudo bash -c \"NOMAD_BINARY=${nomad_binary} CONSUL_BINARY=${consul_binary}  /ops/scripts/client.sh \\\"aws\\\" \\\"${retry_join}\\\" \\\"${node_class}\\\"\"\nrm -rf /ops/\n",
            "vars": {
              "consul_binary": "",
              "node_class": "batch",
              "nomad_binary": "",
              "retry_join": "provider=aws tag_key=ConsulAutoJoin tag_value=auto-join"
            }
          }
        }
      ]
    },
    {
      "module": "module.clients_batch",
      "mode": "managed",
      "type": "aws_autoscaling_group",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:autoscaling:us-east-1:267023797923:autoScalingGroup:82424535-c0cf-4633-ad7e-3b5b6dde37d4:autoScalingGroupName/set-squirrel-batch20210702063839077800000013",
            "availability_zones": [
              "us-east-1a"
            ],
            "default_cooldown": 300,
            "desired_capacity": 0,
            "enabled_metrics": null,
            "force_delete": false,
            "health_check_grace_period": 300,
            "health_check_type": "EC2",
            "id": "set-squirrel-batch20210702063839077800000013",
            "initial_lifecycle_hook": [],
            "launch_configuration": "",
            "launch_template": [
              {
                "id": "lt-03515be8b5aad7a42",
                "name": "set-squirrel-batch2021070206383768870000000e",
                "version": "$Latest"
              }
            ],
            "load_balancers": [],
            "max_instance_lifetime": 0,
            "max_size": 5,
            "metrics_granularity": "1Minute",
            "min_elb_capacity": null,
            "min_size": 0,
            "mixed_instances_policy": [],
            "name": "set-squirrel-batch20210702063839077800000013",
            "name_prefix": "set-squirrel-batch",
            "placement_group": "",
            "protect_from_scale_in": false,
            "service_linked_role_arn": "arn:aws:iam::267023797923:role/aws-service-role/autoscaling.amazonaws.com/AWSServiceRoleForAutoScaling",
            "suspended_processes": null,
            "tag": [
              {
                "key": "OwnerEmail",
                "propagate_at_launch": true,
                "value": "lvandyke@hashicorp.com"
              },
              {
                "key": "OwnerName",
                "propagate_at_launch": true,
                "value": "lvandyke"
              }
            ],
            "tags": null,
            "target_group_arns": [],
            "termination_policies": null,
            "timeouts": null,
            "vpc_zone_identifier": [],
            "wait_for_capacity_timeout": "10m",
            "wait_for_elb_capacity": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiZGVsZXRlIjo2MDAwMDAwMDAwMDB9fQ==",
          "dependencies": [
            "data.http.my_ip",
            "module.clients_batch.aws_iam_instance_profile.clients",
            "module.clients_batch.aws_iam_role.clients",
            "module.clients_batch.aws_launch_template.clients",
            "module.clients_batch.data.aws_iam_policy_document.assume_role",
            "module.clients_batch.data.template_file.user_data",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.clients_batch",
      "mode": "managed",
      "type": "aws_iam_instance_profile",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::267023797923:instance-profile/set-squirrel20210702062758607700000004",
            "create_date": "2021-07-02T06:27:59Z",
            "id": "set-squirrel20210702062758607700000004",
            "name": "set-squirrel20210702062758607700000004",
            "name_prefix": "set-squirrel",
            "path": "/",
            "role": "set-squirrel20210702062757699400000001",
            "roles": [],
            "unique_id": "AIPAT4K63Z2R6BSM5CFKO"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "module.clients_batch.aws_iam_role.clients",
            "module.clients_batch.data.aws_iam_policy_document.assume_role",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.clients_batch",
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::267023797923:role/set-squirrel20210702062757699400000001",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2021-07-02T06:27:58Z",
            "description": "",
            "force_detach_policies": false,
            "id": "set-squirrel20210702062757699400000001",
            "max_session_duration": 3600,
            "name": "set-squirrel20210702062757699400000001",
            "name_prefix": "set-squirrel",
            "path": "/",
            "permissions_boundary": null,
            "tags": {
              "OwnerEmail": "lvandyke@hashicorp.com",
              "OwnerName": "lvandyke"
            },
            "unique_id": "AROAT4K63Z2RZA7GC3WJ4"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "module.clients_batch.data.aws_iam_policy_document.assume_role",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.clients_batch",
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "set-squirrel20210702062757699400000001:set-squirrel20210702062758607800000005",
            "name": "set-squirrel20210702062758607800000005",
            "name_prefix": "set-squirrel",
            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:DescribeInstances\",\n        \"autoscaling:UpdateAutoScalingGroup\",\n        \"autoscaling:TerminateInstanceInAutoScalingGroup\",\n        \"autoscaling:DescribeScalingActivities\",\n        \"autoscaling:DescribeAutoScalingGroups\",\n        \"autoscaling:CreateOrUpdateTags\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}",
            "role": "set-squirrel20210702062757699400000001"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "module.clients_batch.aws_iam_role.clients",
            "module.clients_batch.data.aws_iam_policy_document.assume_role",
            "module.clients_batch.data.aws_iam_policy_document.clients",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.clients_batch",
      "mode": "managed",
      "type": "aws_launch_template",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:267023797923:launch-template/lt-03515be8b5aad7a42",
            "block_device_mappings": [
              {
                "device_name": "/dev/xvdd",
                "ebs": [
                  {
                    "delete_on_termination": "true",
                    "encrypted": "",
                    "iops": 0,
                    "kms_key_id": "",
                    "snapshot_id": "",
                    "volume_size": 50,
                    "volume_type": "gp2"
                  }
                ],
                "no_device": "",
                "virtual_name": ""
              }
            ],
            "capacity_reservation_specification": [],
            "cpu_options": [],
            "credit_specification": [],
            "default_version": 1,
            "description": "",
            "disable_api_termination": false,
            "ebs_optimized": "",
            "elastic_gpu_specifications": [],
            "elastic_inference_accelerator": [],
            "hibernation_options": [],
            "iam_instance_profile": [
              {
                "arn": "",
                "name": "set-squirrel20210702062758607700000004"
              }
            ],
            "id": "lt-03515be8b5aad7a42",
            "image_id": "ami-077713ca5adbc0928",
            "instance_initiated_shutdown_behavior": "",
            "instance_market_options": [],
            "instance_type": "t2.small",
            "kernel_id": "",
            "key_name": "lvd-nomad",
            "latest_version": 1,
            "license_specification": [],
            "metadata_options": [],
            "monitoring": [],
            "name": "set-squirrel-batch2021070206383768870000000e",
            "name_prefix": "set-squirrel-batch",
            "network_interfaces": [],
            "placement": [],
            "ram_disk_id": "",
            "security_group_names": null,
            "tag_specifications": [
              {
                "resource_type": "instance",
                "tags": {
                  "ConsulAutoJoin": "auto-join",
                  "Name": "set-squirrel-batch-client",
                  "OwnerEmail": "lvandyke@hashicorp.com",
                  "OwnerName": "lvandyke"
                }
              }
            ],
            "tags": null,
            "update_default_version": null,
            "user_data": "IyEvYmluL2Jhc2gKCnNldCAtZQoKZXhlYyA+ID4oc3VkbyB0ZWUgL3Zhci9sb2cvdXNlci1kYXRhLmxvZ3xsb2dnZXIgLXQgdXNlci1kYXRhIC1zIDI+L2Rldi9jb25zb2xlKSAyPiYxCnN1ZG8gY2htb2QgK3ggL29wcy9zY3JpcHRzL2NsaWVudC5zaApzdWRvIGJhc2ggLWMgIk5PTUFEX0JJTkFSWT0gQ09OU1VMX0JJTkFSWT0gIC9vcHMvc2NyaXB0cy9jbGllbnQuc2ggXCJhd3NcIiBcInByb3ZpZGVyPWF3cyB0YWdfa2V5PUNvbnN1bEF1dG9Kb2luIHRhZ192YWx1ZT1hdXRvLWpvaW5cIiBcImJhdGNoXCIiCnJtIC1yZiAvb3BzLwo=",
            "vpc_security_group_ids": [
              "sg-0434be26599f100cb"
            ]
          },
          "private": "bnVsbA==",
          "dependencies": [
            "data.http.my_ip",
            "module.clients_batch.aws_iam_instance_profile.clients",
            "module.clients_batch.aws_iam_role.clients",
            "module.clients_batch.data.aws_iam_policy_document.assume_role",
            "module.clients_batch.data.template_file.user_data",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.clients_platform",
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "assume_role",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "1903849331",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "sts:AssumeRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "ec2.amazonaws.com"
                    ],
                    "type": "Service"
                  }
                ],
                "resources": [],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "module": "module.clients_platform",
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "1474532532",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:DescribeInstances\",\n        \"autoscaling:UpdateAutoScalingGroup\",\n        \"autoscaling:TerminateInstanceInAutoScalingGroup\",\n        \"autoscaling:DescribeScalingActivities\",\n        \"autoscaling:DescribeAutoScalingGroups\",\n        \"autoscaling:CreateOrUpdateTags\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "autoscaling:CreateOrUpdateTags",
                  "autoscaling:DescribeAutoScalingGroups",
                  "autoscaling:DescribeScalingActivities",
                  "autoscaling:TerminateInstanceInAutoScalingGroup",
                  "autoscaling:UpdateAutoScalingGroup",
                  "ec2:DescribeInstances"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "*"
                ],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "module": "module.clients_platform",
      "mode": "data",
      "type": "template_file",
      "name": "user_data",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "4a40a6c7d7d05f93abaad6d4ff1c346897ac106918e9755d50fea3d84c497bb6",
            "rendered": "#!/bin/bash\n\nset -e\n\nexec \u003e \u003e(sudo tee /var/log/user-data.log|logger -t user-data -s 2\u003e/dev/console) 2\u003e\u00261\nsudo chmod +x /ops/scripts/client.sh\nsudo bash -c \"NOMAD_BINARY= CONSUL_BINARY=  /ops/scripts/client.sh \\\"aws\\\" \\\"provider=aws tag_key=ConsulAutoJoin tag_value=auto-join\\\" \\\"platform\\\"\"\nrm -rf /ops/\n",
            "template": "#!/bin/bash\n\nset -e\n\nexec \u003e \u003e(sudo tee /var/log/user-data.log|logger -t user-data -s 2\u003e/dev/console) 2\u003e\u00261\nsudo chmod +x /ops/scripts/client.sh\nsudo bash -c \"NOMAD_BINARY=${nomad_binary} CONSUL_BINARY=${consul_binary}  /ops/scripts/client.sh \\\"aws\\\" \\\"${retry_join}\\\" \\\"${node_class}\\\"\"\nrm -rf /ops/\n",
            "vars": {
              "consul_binary": "",
              "node_class": "platform",
              "nomad_binary": "",
              "retry_join": "provider=aws tag_key=ConsulAutoJoin tag_value=auto-join"
            }
          }
        }
      ]
    },
    {
      "module": "module.clients_platform",
      "mode": "managed",
      "type": "aws_autoscaling_group",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:autoscaling:us-east-1:267023797923:autoScalingGroup:6b880a8b-4c3f-447c-b3ad-b3d3a87fd717:autoScalingGroupName/set-squirrel-platform20210702063839077400000012",
            "availability_zones": [
              "us-east-1a"
            ],
            "default_cooldown": 300,
            "desired_capacity": 1,
            "enabled_metrics": null,
            "force_delete": false,
            "health_check_grace_period": 300,
            "health_check_type": "EC2",
            "id": "set-squirrel-platform20210702063839077400000012",
            "initial_lifecycle_hook": [],
            "launch_configuration": "",
            "launch_template": [
              {
                "id": "lt-0cb3c78ad84a467bd",
                "name": "set-squirrel-platform2021070206383768870000000f",
                "version": "$Latest"
              }
            ],
            "load_balancers": [
              "set-squirrel-platform"
            ],
            "max_instance_lifetime": 0,
            "max_size": 5,
            "metrics_granularity": "1Minute",
            "min_elb_capacity": null,
            "min_size": 0,
            "mixed_instances_policy": [],
            "name": "set-squirrel-platform20210702063839077400000012",
            "name_prefix": "set-squirrel-platform",
            "placement_group": "",
            "protect_from_scale_in": false,
            "service_linked_role_arn": "arn:aws:iam::267023797923:role/aws-service-role/autoscaling.amazonaws.com/AWSServiceRoleForAutoScaling",
            "suspended_processes": null,
            "tag": [
              {
                "key": "OwnerEmail",
                "propagate_at_launch": true,
                "value": "lvandyke@hashicorp.com"
              },
              {
                "key": "OwnerName",
                "propagate_at_launch": true,
                "value": "lvandyke"
              }
            ],
            "tags": null,
            "target_group_arns": [],
            "termination_policies": null,
            "timeouts": null,
            "vpc_zone_identifier": [],
            "wait_for_capacity_timeout": "10m",
            "wait_for_elb_capacity": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiZGVsZXRlIjo2MDAwMDAwMDAwMDB9fQ==",
          "dependencies": [
            "data.http.my_ip",
            "module.clients_platform.aws_iam_instance_profile.clients",
            "module.clients_platform.aws_iam_role.clients",
            "module.clients_platform.aws_launch_template.clients",
            "module.clients_platform.data.aws_iam_policy_document.assume_role",
            "module.clients_platform.data.template_file.user_data",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_elb.clients",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.clients",
            "module.network.aws_security_group.clients_lb",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.clients_platform",
      "mode": "managed",
      "type": "aws_iam_instance_profile",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::267023797923:instance-profile/set-squirrel20210702062758607900000006",
            "create_date": "2021-07-02T06:27:59Z",
            "id": "set-squirrel20210702062758607900000006",
            "name": "set-squirrel20210702062758607900000006",
            "name_prefix": "set-squirrel",
            "path": "/",
            "role": "set-squirrel20210702062757701900000003",
            "roles": [],
            "unique_id": "AIPAT4K63Z2RS5EIO47AV"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "module.clients_platform.aws_iam_role.clients",
            "module.clients_platform.data.aws_iam_policy_document.assume_role",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.clients_platform",
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::267023797923:role/set-squirrel20210702062757701900000003",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2021-07-02T06:27:58Z",
            "description": "",
            "force_detach_policies": false,
            "id": "set-squirrel20210702062757701900000003",
            "max_session_duration": 3600,
            "name": "set-squirrel20210702062757701900000003",
            "name_prefix": "set-squirrel",
            "path": "/",
            "permissions_boundary": null,
            "tags": {
              "OwnerEmail": "lvandyke@hashicorp.com",
              "OwnerName": "lvandyke"
            },
            "unique_id": "AROAT4K63Z2RYHGMHLXWQ"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "module.clients_platform.data.aws_iam_policy_document.assume_role",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.clients_platform",
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "set-squirrel20210702062757701900000003:set-squirrel20210702062758608100000008",
            "name": "set-squirrel20210702062758608100000008",
            "name_prefix": "set-squirrel",
            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:DescribeInstances\",\n        \"autoscaling:UpdateAutoScalingGroup\",\n        \"autoscaling:TerminateInstanceInAutoScalingGroup\",\n        \"autoscaling:DescribeScalingActivities\",\n        \"autoscaling:DescribeAutoScalingGroups\",\n        \"autoscaling:CreateOrUpdateTags\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}",
            "role": "set-squirrel20210702062757701900000003"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "module.clients_platform.aws_iam_role.clients",
            "module.clients_platform.data.aws_iam_policy_document.assume_role",
            "module.clients_platform.data.aws_iam_policy_document.clients",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.clients_platform",
      "mode": "managed",
      "type": "aws_launch_template",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:267023797923:launch-template/lt-0cb3c78ad84a467bd",
            "block_device_mappings": [
              {
                "device_name": "/dev/xvdd",
                "ebs": [
                  {
                    "delete_on_termination": "true",
                    "encrypted": "",
                    "iops": 0,
                    "kms_key_id": "",
                    "snapshot_id": "",
                    "volume_size": 50,
                    "volume_type": "gp2"
                  }
                ],
                "no_device": "",
                "virtual_name": ""
              }
            ],
            "capacity_reservation_specification": [],
            "cpu_options": [],
            "credit_specification": [],
            "default_version": 1,
            "description": "",
            "disable_api_termination": false,
            "ebs_optimized": "",
            "elastic_gpu_specifications": [],
            "elastic_inference_accelerator": [],
            "hibernation_options": [],
            "iam_instance_profile": [
              {
                "arn": "",
                "name": "set-squirrel20210702062758607900000006"
              }
            ],
            "id": "lt-0cb3c78ad84a467bd",
            "image_id": "ami-077713ca5adbc0928",
            "instance_initiated_shutdown_behavior": "",
            "instance_market_options": [],
            "instance_type": "t2.small",
            "kernel_id": "",
            "key_name": "lvd-nomad",
            "latest_version": 1,
            "license_specification": [],
            "metadata_options": [],
            "monitoring": [],
            "name": "set-squirrel-platform2021070206383768870000000f",
            "name_prefix": "set-squirrel-platform",
            "network_interfaces": [],
            "placement": [],
            "ram_disk_id": "",
            "security_group_names": null,
            "tag_specifications": [
              {
                "resource_type": "instance",
                "tags": {
                  "ConsulAutoJoin": "auto-join",
                  "Name": "set-squirrel-platform-client",
                  "OwnerEmail": "lvandyke@hashicorp.com",
                  "OwnerName": "lvandyke"
                }
              }
            ],
            "tags": null,
            "update_default_version": null,
            "user_data": "IyEvYmluL2Jhc2gKCnNldCAtZQoKZXhlYyA+ID4oc3VkbyB0ZWUgL3Zhci9sb2cvdXNlci1kYXRhLmxvZ3xsb2dnZXIgLXQgdXNlci1kYXRhIC1zIDI+L2Rldi9jb25zb2xlKSAyPiYxCnN1ZG8gY2htb2QgK3ggL29wcy9zY3JpcHRzL2NsaWVudC5zaApzdWRvIGJhc2ggLWMgIk5PTUFEX0JJTkFSWT0gQ09OU1VMX0JJTkFSWT0gIC9vcHMvc2NyaXB0cy9jbGllbnQuc2ggXCJhd3NcIiBcInByb3ZpZGVyPWF3cyB0YWdfa2V5PUNvbnN1bEF1dG9Kb2luIHRhZ192YWx1ZT1hdXRvLWpvaW5cIiBcInBsYXRmb3JtXCIiCnJtIC1yZiAvb3BzLwo=",
            "vpc_security_group_ids": [
              "sg-0434be26599f100cb",
              "sg-0ab191132dc00da29"
            ]
          },
          "private": "bnVsbA==",
          "dependencies": [
            "data.http.my_ip",
            "module.clients_platform.aws_iam_instance_profile.clients",
            "module.clients_platform.aws_iam_role.clients",
            "module.clients_platform.data.aws_iam_policy_document.assume_role",
            "module.clients_platform.data.template_file.user_data",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.clients",
            "module.network.aws_security_group.clients_lb",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.image",
      "mode": "data",
      "type": "aws_ami",
      "name": "built",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "architecture": "x86_64",
            "arn": "arn:aws:ec2:us-east-1::image/ami-077713ca5adbc0928",
            "block_device_mappings": [
              {
                "device_name": "/dev/sda1",
                "ebs": {
                  "delete_on_termination": "true",
                  "encrypted": "false",
                  "iops": "0",
                  "snapshot_id": "snap-061e8dbb42980f527",
                  "volume_size": "8",
                  "volume_type": "gp2"
                },
                "no_device": "",
                "virtual_name": ""
              },
              {
                "device_name": "/dev/sdb",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral0"
              },
              {
                "device_name": "/dev/sdc",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral1"
              }
            ],
            "creation_date": "2021-07-02T06:32:37.000Z",
            "description": null,
            "executable_users": null,
            "filter": [
              {
                "name": "name",
                "values": [
                  "set-squirrel"
                ]
              }
            ],
            "hypervisor": "xen",
            "id": "ami-077713ca5adbc0928",
            "image_id": "ami-077713ca5adbc0928",
            "image_location": "267023797923/set-squirrel",
            "image_owner_alias": null,
            "image_type": "machine",
            "kernel_id": null,
            "most_recent": true,
            "name": "set-squirrel",
            "name_regex": null,
            "owner_id": "267023797923",
            "owners": [
              "self"
            ],
            "platform": null,
            "product_codes": [],
            "public": false,
            "ramdisk_id": null,
            "root_device_name": "/dev/sda1",
            "root_device_type": "ebs",
            "root_snapshot_id": "snap-061e8dbb42980f527",
            "sriov_net_support": "simple",
            "state": "available",
            "state_reason": {
              "code": "UNSET",
              "message": "UNSET"
            },
            "tags": {
              "Architecture": "amd64",
              "OS": "Ubuntu",
              "OwnerEmail": "lvandyke@hashicorp.com",
              "OwnerName": "lvandyke",
              "Release": "20.04"
            },
            "virtualization_type": "hvm"
          }
        }
      ]
    },
    {
      "module": "module.image",
      "mode": "managed",
      "type": "local_file",
      "name": "cleanup",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "content": "ami-077713ca5adbc0928,snap-061e8dbb42980f527,us-east-1",
            "content_base64": null,
            "directory_permission": "0777",
            "file_permission": "0777",
            "filename": ".cleanup",
            "id": "daa95ddca10517fc6e22003749a293691290b9d8",
            "sensitive_content": null,
            "source": null
          },
          "private": "bnVsbA==",
          "dependencies": [
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.image",
      "mode": "managed",
      "type": "null_resource",
      "name": "packer_build",
      "provider": "provider[\"registry.terraform.io/hashicorp/null\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "id": "5948818063215517083",
            "triggers": null
          },
          "private": "bnVsbA==",
          "dependencies": [
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.network",
      "mode": "data",
      "type": "aws_vpc",
      "name": "default",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:267023797923:vpc/vpc-271a045d",
            "cidr_block": "172.31.0.0/16",
            "cidr_block_associations": [
              {
                "association_id": "vpc-cidr-assoc-e4e70c8b",
                "cidr_block": "172.31.0.0/16",
                "state": "associated"
              }
            ],
            "default": true,
            "dhcp_options_id": "dopt-27c3785d",
            "enable_dns_hostnames": true,
            "enable_dns_support": true,
            "filter": null,
            "id": "vpc-271a045d",
            "instance_tenancy": "default",
            "ipv6_association_id": null,
            "ipv6_cidr_block": null,
            "main_route_table_id": "rtb-d36500ad",
            "owner_id": "267023797923",
            "state": "available",
            "tags": {
              "Name": "aji_hcp_consul_vault"
            }
          }
        }
      ]
    },
    {
      "module": "module.network",
      "mode": "managed",
      "type": "aws_elb",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "access_logs": [],
            "arn": "arn:aws:elasticloadbalancing:us-east-1:267023797923:loadbalancer/set-squirrel-platform",
            "availability_zones": [
              "us-east-1a"
            ],
            "connection_draining": false,
            "connection_draining_timeout": 300,
            "cross_zone_load_balancing": true,
            "dns_name": "set-squirrel-platform-1400111000.us-east-1.elb.amazonaws.com",
            "health_check": [
              {
                "healthy_threshold": 3,
                "interval": 30,
                "target": "TCP:8081",
                "timeout": 3,
                "unhealthy_threshold": 2
              }
            ],
            "id": "set-squirrel-platform",
            "idle_timeout": 60,
            "instances": [],
            "internal": false,
            "listener": [
              {
                "instance_port": 3000,
                "instance_protocol": "TCP",
                "lb_port": 3000,
                "lb_protocol": "TCP",
                "ssl_certificate_id": ""
              },
              {
                "instance_port": 8081,
                "instance_protocol": "TCP",
                "lb_port": 8081,
                "lb_protocol": "TCP",
                "ssl_certificate_id": ""
              },
              {
                "instance_port": 9090,
                "instance_protocol": "TCP",
                "lb_port": 9090,
                "lb_protocol": "TCP",
                "ssl_certificate_id": ""
              }
            ],
            "name": "set-squirrel-platform",
            "name_prefix": null,
            "security_groups": [
              "sg-0ab191132dc00da29"
            ],
            "source_security_group": "267023797923/set-squirrel-platform-clients2021070206280454050000000c",
            "source_security_group_id": "sg-0ab191132dc00da29",
            "subnets": [
              "subnet-fc1e8cb1"
            ],
            "tags": {
              "OwnerEmail": "lvandyke@hashicorp.com",
              "OwnerName": "lvandyke"
            },
            "zone_id": "Z35SXDOTRQ7X7K"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "data.http.my_ip",
            "module.network.aws_security_group.clients",
            "module.network.aws_security_group.clients_lb",
            "module.network.data.aws_vpc.default",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.network",
      "mode": "managed",
      "type": "aws_elb",
      "name": "servers",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "access_logs": [],
            "arn": "arn:aws:elasticloadbalancing:us-east-1:267023797923:loadbalancer/set-squirrel-servers",
            "availability_zones": [
              "us-east-1a"
            ],
            "connection_draining": false,
            "connection_draining_timeout": 300,
            "cross_zone_load_balancing": true,
            "dns_name": "set-squirrel-servers-1026535637.us-east-1.elb.amazonaws.com",
            "health_check": [
              {
                "healthy_threshold": 10,
                "interval": 30,
                "target": "TCP:4646",
                "timeout": 5,
                "unhealthy_threshold": 2
              }
            ],
            "id": "set-squirrel-servers",
            "idle_timeout": 360,
            "instances": [
              "i-08823b924ebcbd248"
            ],
            "internal": false,
            "listener": [
              {
                "instance_port": 4646,
                "instance_protocol": "http",
                "lb_port": 4646,
                "lb_protocol": "http",
                "ssl_certificate_id": ""
              },
              {
                "instance_port": 8500,
                "instance_protocol": "http",
                "lb_port": 8500,
                "lb_protocol": "http",
                "ssl_certificate_id": ""
              }
            ],
            "name": "set-squirrel-servers",
            "name_prefix": null,
            "security_groups": [
              "sg-0bf62a92de96418cb"
            ],
            "source_security_group": "267023797923/set-squirrel-servers-lb2021070206275923090000000a",
            "source_security_group_id": "sg-0bf62a92de96418cb",
            "subnets": [
              "subnet-fc1e8cb1"
            ],
            "tags": {
              "OwnerEmail": "lvandyke@hashicorp.com",
              "OwnerName": "lvandyke"
            },
            "zone_id": "Z35SXDOTRQ7X7K"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "data.http.my_ip",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "module.servers.aws_iam_instance_profile.servers",
            "module.servers.aws_iam_role.servers",
            "module.servers.aws_instance.servers",
            "module.servers.data.aws_iam_policy_document.assume",
            "module.servers.data.template_file.user_data",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.network",
      "mode": "managed",
      "type": "aws_security_group",
      "name": "agents",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:267023797923:security-group/sg-0434be26599f100cb",
            "description": "Managed by Terraform",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-0434be26599f100cb",
            "ingress": [
              {
                "cidr_blocks": [
                  "72.197.144.63/32"
                ],
                "description": "",
                "from_port": 22,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 22
              },
              {
                "cidr_blocks": [
                  "72.197.144.63/32"
                ],
                "description": "",
                "from_port": 4646,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [
                  "sg-0bf62a92de96418cb"
                ],
                "self": false,
                "to_port": 4646
              },
              {
                "cidr_blocks": [
                  "72.197.144.63/32"
                ],
                "description": "",
                "from_port": 8500,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [
                  "sg-0bf62a92de96418cb"
                ],
                "self": false,
                "to_port": 8500
              },
              {
                "cidr_blocks": [],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": true,
                "to_port": 0
              }
            ],
            "name": "set-squirrel-agents2021070206280466060000000d",
            "name_prefix": "set-squirrel-agents",
            "owner_id": "267023797923",
            "revoke_rules_on_delete": false,
            "tags": {
              "OwnerEmail": "lvandyke@hashicorp.com",
              "OwnerName": "lvandyke"
            },
            "timeouts": null,
            "vpc_id": "vpc-271a045d"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "data.http.my_ip",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.network",
      "mode": "managed",
      "type": "aws_security_group",
      "name": "clients",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:267023797923:security-group/sg-0ab191132dc00da29",
            "description": "Managed by Terraform",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-0ab191132dc00da29",
            "ingress": [
              {
                "cidr_blocks": [
                  "72.197.144.63/32"
                ],
                "description": "",
                "from_port": 3000,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [
                  "sg-0d56b323dcff049d4"
                ],
                "self": false,
                "to_port": 3000
              },
              {
                "cidr_blocks": [
                  "72.197.144.63/32"
                ],
                "description": "",
                "from_port": 8081,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [
                  "sg-0d56b323dcff049d4"
                ],
                "self": false,
                "to_port": 8081
              },
              {
                "cidr_blocks": [
                  "72.197.144.63/32"
                ],
                "description": "",
                "from_port": 9090,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [
                  "sg-0d56b323dcff049d4"
                ],
                "self": false,
                "to_port": 9090
              },
              {
                "cidr_blocks": [],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": true,
                "to_port": 0
              }
            ],
            "name": "set-squirrel-platform-clients2021070206280454050000000c",
            "name_prefix": "set-squirrel-platform-clients",
            "owner_id": "267023797923",
            "revoke_rules_on_delete": false,
            "tags": {
              "OwnerEmail": "lvandyke@hashicorp.com",
              "OwnerName": "lvandyke"
            },
            "timeouts": null,
            "vpc_id": "vpc-271a045d"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "data.http.my_ip",
            "module.network.aws_security_group.clients_lb",
            "module.network.data.aws_vpc.default",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.network",
      "mode": "managed",
      "type": "aws_security_group",
      "name": "clients_lb",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:267023797923:security-group/sg-0d56b323dcff049d4",
            "description": "Managed by Terraform",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-0d56b323dcff049d4",
            "ingress": [
              {
                "cidr_blocks": [
                  "72.197.144.63/32"
                ],
                "description": "",
                "from_port": 3000,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 3000
              },
              {
                "cidr_blocks": [
                  "72.197.144.63/32"
                ],
                "description": "",
                "from_port": 8081,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 8081
              },
              {
                "cidr_blocks": [
                  "72.197.144.63/32"
                ],
                "description": "",
                "from_port": 9090,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 9090
              }
            ],
            "name": "set-squirrel-platform-clients-lb2021070206275923290000000b",
            "name_prefix": "set-squirrel-platform-clients-lb",
            "owner_id": "267023797923",
            "revoke_rules_on_delete": false,
            "tags": {
              "OwnerEmail": "lvandyke@hashicorp.com",
              "OwnerName": "lvandyke"
            },
            "timeouts": null,
            "vpc_id": "vpc-271a045d"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "data.http.my_ip",
            "module.network.data.aws_vpc.default",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.network",
      "mode": "managed",
      "type": "aws_security_group",
      "name": "servers_lb",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:267023797923:security-group/sg-0bf62a92de96418cb",
            "description": "Managed by Terraform",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-0bf62a92de96418cb",
            "ingress": [
              {
                "cidr_blocks": [
                  "72.197.144.63/32"
                ],
                "description": "",
                "from_port": 4646,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 4646
              },
              {
                "cidr_blocks": [
                  "72.197.144.63/32"
                ],
                "description": "",
                "from_port": 8500,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 8500
              }
            ],
            "name": "set-squirrel-servers-lb2021070206275923090000000a",
            "name_prefix": "set-squirrel-servers-lb",
            "owner_id": "267023797923",
            "revoke_rules_on_delete": false,
            "tags": {
              "OwnerEmail": "lvandyke@hashicorp.com",
              "OwnerName": "lvandyke"
            },
            "timeouts": null,
            "vpc_id": "vpc-271a045d"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "data.http.my_ip",
            "module.network.data.aws_vpc.default",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.nomad_jobs",
      "mode": "data",
      "type": "local_file",
      "name": "grafana_dashboard",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "{\n  \"annotations\": {\n    \"list\": [\n      {\n        \"builtIn\": 1,\n        \"datasource\": \"-- Grafana --\",\n        \"enable\": true,\n        \"hide\": true,\n        \"iconColor\": \"rgba(0, 211, 255, 1)\",\n        \"limit\": 100,\n        \"name\": \"Annotations \u0026 Alerts\",\n        \"showIn\": 0,\n        \"type\": \"dashboard\"\n      },\n      {\n        \"datasource\": \"Loki\",\n        \"enable\": true,\n        \"expr\": \"{task=\\\"autoscaler\\\"} |= \\\"scaling target\\\" | logfmt | line_format \\\"{{.reason}}\\\"\",\n        \"hide\": false,\n        \"iconColor\": \"#5794F2\",\n        \"name\": \"Autoscaler\",\n        \"showIn\": 0,\n        \"target\": {}\n      }\n    ]\n  },\n  \"editable\": true,\n  \"gnetId\": null,\n  \"graphTooltip\": 0,\n  \"links\": [],\n  \"panels\": [\n    {\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {\n          \"color\": {\n            \"fixedColor\": \"green\",\n            \"mode\": \"palette-classic\"\n          },\n          \"custom\": {},\n          \"mappings\": [],\n          \"thresholds\": {\n            \"mode\": \"absolute\",\n            \"steps\": [\n              {\n                \"color\": \"green\",\n                \"value\": null\n              },\n              {\n                \"color\": \"red\",\n                \"value\": 80\n              }\n            ]\n          }\n        },\n        \"overrides\": [\n          {\n            \"matcher\": {\n              \"id\": \"byName\",\n              \"options\": \"complete\"\n            },\n            \"properties\": [\n              {\n                \"id\": \"color\",\n                \"value\": {\n                  \"fixedColor\": \"green\",\n                  \"mode\": \"fixed\"\n                }\n              }\n            ]\n          },\n          {\n            \"matcher\": {\n              \"id\": \"byName\",\n              \"options\": \"failed\"\n            },\n            \"properties\": [\n              {\n                \"id\": \"color\",\n                \"value\": {\n                  \"fixedColor\": \"red\",\n                  \"mode\": \"fixed\"\n                }\n              }\n            ]\n          }\n        ]\n      },\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 17,\n        \"x\": 0,\n        \"y\": 0\n      },\n      \"id\": 14,\n      \"options\": {\n        \"reduceOptions\": {\n          \"calcs\": [\n            \"lastNotNull\"\n          ],\n          \"fields\": \"\",\n          \"values\": false\n        },\n        \"showThresholdLabels\": false,\n        \"showThresholdMarkers\": true,\n        \"text\": {}\n      },\n      \"pluginVersion\": \"7.4.2\",\n      \"targets\": [\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_queued{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"interval\": \"\",\n          \"legendFormat\": \"queued\",\n          \"refId\": \"A\"\n        },\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_running{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"running\",\n          \"refId\": \"B\"\n        },\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_complete{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"complete\",\n          \"refId\": \"C\"\n        },\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_failed{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"failed\",\n          \"refId\": \"D\"\n        }\n      ],\n      \"title\": \"Batch job count per status\",\n      \"type\": \"gauge\"\n    },\n    {\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {\n          \"color\": {\n            \"mode\": \"palette-classic\"\n          },\n          \"custom\": {},\n          \"decimals\": 0,\n          \"mappings\": [],\n          \"max\": 5,\n          \"min\": 0,\n          \"noValue\": \"0\",\n          \"thresholds\": {\n            \"mode\": \"absolute\",\n            \"steps\": [\n              {\n                \"color\": \"green\",\n                \"value\": null\n              },\n              {\n                \"color\": \"red\",\n                \"value\": 80\n              }\n            ]\n          }\n        },\n        \"overrides\": [\n          {\n            \"matcher\": {\n              \"id\": \"byRegexp\",\n              \"options\": \"batch\"\n            },\n            \"properties\": [\n              {\n                \"id\": \"color\",\n                \"value\": {\n                  \"fixedColor\": \"green\",\n                  \"mode\": \"fixed\"\n                }\n              }\n            ]\n          },\n          {\n            \"matcher\": {\n              \"id\": \"byRegexp\",\n              \"options\": \"platform\"\n            },\n            \"properties\": [\n              {\n                \"id\": \"color\",\n                \"value\": {\n                  \"fixedColor\": \"yellow\",\n                  \"mode\": \"fixed\"\n                }\n              }\n            ]\n          }\n        ]\n      },\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 7,\n        \"x\": 17,\n        \"y\": 0\n      },\n      \"id\": 8,\n      \"options\": {\n        \"orientation\": \"auto\",\n        \"reduceOptions\": {\n          \"calcs\": [\n            \"last\"\n          ],\n          \"fields\": \"\",\n          \"values\": false\n        },\n        \"showThresholdLabels\": false,\n        \"showThresholdMarkers\": true,\n        \"text\": {}\n      },\n      \"pluginVersion\": \"7.4.2\",\n      \"targets\": [\n        {\n          \"expr\": \"count by (node_class) (nomad_client_uptime{node_status=\\\"ready\\\"})\",\n          \"interval\": \"\",\n          \"legendFormat\": \"{{node_class}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"timeFrom\": null,\n      \"timeShift\": null,\n      \"title\": \"Clients per node class\",\n      \"type\": \"gauge\"\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": true,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {\n          \"custom\": {}\n        },\n        \"overrides\": []\n      },\n      \"fill\": 10,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 8\n      },\n      \"hiddenSeries\": false,\n      \"id\": 2,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": false,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\": false,\n      \"linewidth\": 0,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.4.2\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [\n        {\n          \"$$hashKey\": \"object:1253\",\n          \"alias\": \"complete\",\n          \"bars\": false,\n          \"fill\": 0,\n          \"lines\": true,\n          \"linewidth\": 1,\n          \"stack\": false,\n          \"yaxis\": 2\n        }\n      ],\n      \"spaceLength\": 10,\n      \"stack\": true,\n      \"steppedLine\": true,\n      \"targets\": [\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_running{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"running\",\n          \"refId\": \"B\"\n        },\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_queued{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"queued\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Batch jobs in progress\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:133\",\n          \"decimals\": 0,\n          \"format\": \"none\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:134\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {\n          \"custom\": {}\n        },\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 8\n      },\n      \"hiddenSeries\": false,\n      \"id\": 10,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": false,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.4.2\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [\n        {\n          \"$$hashKey\": \"object:96\",\n          \"alias\": \"platform\",\n          \"color\": \"#FADE2A\"\n        },\n        {\n          \"$$hashKey\": \"object:104\",\n          \"alias\": \"batch\",\n          \"color\": \"#73BF69\"\n        }\n      ],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": true,\n      \"targets\": [\n        {\n          \"expr\": \"count by (node_class) (nomad_client_uptime{node_status=\\\"ready\\\"})\",\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{node_class}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Number of clients\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1577\",\n          \"decimals\": 0,\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": \"0\",\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1578\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    }\n  ],\n  \"refresh\": \"5s\",\n  \"schemaVersion\": 27,\n  \"style\": \"dark\",\n  \"tags\": [],\n  \"templating\": {\n    \"list\": []\n  },\n  \"time\": {\n    \"from\": \"now-15m\",\n    \"to\": \"now\"\n  },\n  \"timepicker\": {},\n  \"timezone\": \"\",\n  \"title\": \"On-demand batch job demo\",\n  \"uid\": \"CJlc3r_Mk\",\n  \"version\": 1\n}\n",
            "content_base64": "ewogICJhbm5vdGF0aW9ucyI6IHsKICAgICJsaXN0IjogWwogICAgICB7CiAgICAgICAgImJ1aWx0SW4iOiAxLAogICAgICAgICJkYXRhc291cmNlIjogIi0tIEdyYWZhbmEgLS0iLAogICAgICAgICJlbmFibGUiOiB0cnVlLAogICAgICAgICJoaWRlIjogdHJ1ZSwKICAgICAgICAiaWNvbkNvbG9yIjogInJnYmEoMCwgMjExLCAyNTUsIDEpIiwKICAgICAgICAibGltaXQiOiAxMDAsCiAgICAgICAgIm5hbWUiOiAiQW5ub3RhdGlvbnMgJiBBbGVydHMiLAogICAgICAgICJzaG93SW4iOiAwLAogICAgICAgICJ0eXBlIjogImRhc2hib2FyZCIKICAgICAgfSwKICAgICAgewogICAgICAgICJkYXRhc291cmNlIjogIkxva2kiLAogICAgICAgICJlbmFibGUiOiB0cnVlLAogICAgICAgICJleHByIjogInt0YXNrPVwiYXV0b3NjYWxlclwifSB8PSBcInNjYWxpbmcgdGFyZ2V0XCIgfCBsb2dmbXQgfCBsaW5lX2Zvcm1hdCBcInt7LnJlYXNvbn19XCIiLAogICAgICAgICJoaWRlIjogZmFsc2UsCiAgICAgICAgImljb25Db2xvciI6ICIjNTc5NEYyIiwKICAgICAgICAibmFtZSI6ICJBdXRvc2NhbGVyIiwKICAgICAgICAic2hvd0luIjogMCwKICAgICAgICAidGFyZ2V0Ijoge30KICAgICAgfQogICAgXQogIH0sCiAgImVkaXRhYmxlIjogdHJ1ZSwKICAiZ25ldElkIjogbnVsbCwKICAiZ3JhcGhUb29sdGlwIjogMCwKICAibGlua3MiOiBbXSwKICAicGFuZWxzIjogWwogICAgewogICAgICAiZGF0YXNvdXJjZSI6IG51bGwsCiAgICAgICJmaWVsZENvbmZpZyI6IHsKICAgICAgICAiZGVmYXVsdHMiOiB7CiAgICAgICAgICAiY29sb3IiOiB7CiAgICAgICAgICAgICJmaXhlZENvbG9yIjogImdyZWVuIiwKICAgICAgICAgICAgIm1vZGUiOiAicGFsZXR0ZS1jbGFzc2ljIgogICAgICAgICAgfSwKICAgICAgICAgICJjdXN0b20iOiB7fSwKICAgICAgICAgICJtYXBwaW5ncyI6IFtdLAogICAgICAgICAgInRocmVzaG9sZHMiOiB7CiAgICAgICAgICAgICJtb2RlIjogImFic29sdXRlIiwKICAgICAgICAgICAgInN0ZXBzIjogWwogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJjb2xvciI6ICJncmVlbiIsCiAgICAgICAgICAgICAgICAidmFsdWUiOiBudWxsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiY29sb3IiOiAicmVkIiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6IDgwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAib3ZlcnJpZGVzIjogWwogICAgICAgICAgewogICAgICAgICAgICAibWF0Y2hlciI6IHsKICAgICAgICAgICAgICAiaWQiOiAiYnlOYW1lIiwKICAgICAgICAgICAgICAib3B0aW9ucyI6ICJjb21wbGV0ZSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgImlkIjogImNvbG9yIiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHsKICAgICAgICAgICAgICAgICAgImZpeGVkQ29sb3IiOiAiZ3JlZW4iLAogICAgICAgICAgICAgICAgICAibW9kZSI6ICJmaXhlZCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0KICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgICJtYXRjaGVyIjogewogICAgICAgICAgICAgICJpZCI6ICJieU5hbWUiLAogICAgICAgICAgICAgICJvcHRpb25zIjogImZhaWxlZCIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgImlkIjogImNvbG9yIiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHsKICAgICAgICAgICAgICAgICAgImZpeGVkQ29sb3IiOiAicmVkIiwKICAgICAgICAgICAgICAgICAgIm1vZGUiOiAiZml4ZWQiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgICB9CiAgICAgICAgXQogICAgICB9LAogICAgICAiZ3JpZFBvcyI6IHsKICAgICAgICAiaCI6IDgsCiAgICAgICAgInciOiAxNywKICAgICAgICAieCI6IDAsCiAgICAgICAgInkiOiAwCiAgICAgIH0sCiAgICAgICJpZCI6IDE0LAogICAgICAib3B0aW9ucyI6IHsKICAgICAgICAicmVkdWNlT3B0aW9ucyI6IHsKICAgICAgICAgICJjYWxjcyI6IFsKICAgICAgICAgICAgImxhc3ROb3ROdWxsIgogICAgICAgICAgXSwKICAgICAgICAgICJmaWVsZHMiOiAiIiwKICAgICAgICAgICJ2YWx1ZXMiOiBmYWxzZQogICAgICAgIH0sCiAgICAgICAgInNob3dUaHJlc2hvbGRMYWJlbHMiOiBmYWxzZSwKICAgICAgICAic2hvd1RocmVzaG9sZE1hcmtlcnMiOiB0cnVlLAogICAgICAgICJ0ZXh0Ijoge30KICAgICAgfSwKICAgICAgInBsdWdpblZlcnNpb24iOiAiNy40LjIiLAogICAgICAidGFyZ2V0cyI6IFsKICAgICAgICB7CiAgICAgICAgICAiZXhwciI6ICJzdW0obm9tYWRfbm9tYWRfam9iX3N1bW1hcnlfcXVldWVke2V4cG9ydGVkX2pvYj1+XCJiYXRjaC8uKlwifSkgT1Igb24oKSB2ZWN0b3IoMCkiLAogICAgICAgICAgImludGVydmFsIjogIiIsCiAgICAgICAgICAibGVnZW5kRm9ybWF0IjogInF1ZXVlZCIsCiAgICAgICAgICAicmVmSWQiOiAiQSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJleHByIjogInN1bShub21hZF9ub21hZF9qb2Jfc3VtbWFyeV9ydW5uaW5ne2V4cG9ydGVkX2pvYj1+XCJiYXRjaC8uKlwifSkgT1Igb24oKSB2ZWN0b3IoMCkiLAogICAgICAgICAgImhpZGUiOiBmYWxzZSwKICAgICAgICAgICJpbnRlcnZhbCI6ICIiLAogICAgICAgICAgImxlZ2VuZEZvcm1hdCI6ICJydW5uaW5nIiwKICAgICAgICAgICJyZWZJZCI6ICJCIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgImV4cHIiOiAic3VtKG5vbWFkX25vbWFkX2pvYl9zdW1tYXJ5X2NvbXBsZXRle2V4cG9ydGVkX2pvYj1+XCJiYXRjaC8uKlwifSkgT1Igb24oKSB2ZWN0b3IoMCkiLAogICAgICAgICAgImhpZGUiOiBmYWxzZSwKICAgICAgICAgICJpbnRlcnZhbCI6ICIiLAogICAgICAgICAgImxlZ2VuZEZvcm1hdCI6ICJjb21wbGV0ZSIsCiAgICAgICAgICAicmVmSWQiOiAiQyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJleHByIjogInN1bShub21hZF9ub21hZF9qb2Jfc3VtbWFyeV9mYWlsZWR7ZXhwb3J0ZWRfam9iPX5cImJhdGNoLy4qXCJ9KSBPUiBvbigpIHZlY3RvcigwKSIsCiAgICAgICAgICAiaGlkZSI6IGZhbHNlLAogICAgICAgICAgImludGVydmFsIjogIiIsCiAgICAgICAgICAibGVnZW5kRm9ybWF0IjogImZhaWxlZCIsCiAgICAgICAgICAicmVmSWQiOiAiRCIKICAgICAgICB9CiAgICAgIF0sCiAgICAgICJ0aXRsZSI6ICJCYXRjaCBqb2IgY291bnQgcGVyIHN0YXR1cyIsCiAgICAgICJ0eXBlIjogImdhdWdlIgogICAgfSwKICAgIHsKICAgICAgImRhdGFzb3VyY2UiOiBudWxsLAogICAgICAiZmllbGRDb25maWciOiB7CiAgICAgICAgImRlZmF1bHRzIjogewogICAgICAgICAgImNvbG9yIjogewogICAgICAgICAgICAibW9kZSI6ICJwYWxldHRlLWNsYXNzaWMiCiAgICAgICAgICB9LAogICAgICAgICAgImN1c3RvbSI6IHt9LAogICAgICAgICAgImRlY2ltYWxzIjogMCwKICAgICAgICAgICJtYXBwaW5ncyI6IFtdLAogICAgICAgICAgIm1heCI6IDUsCiAgICAgICAgICAibWluIjogMCwKICAgICAgICAgICJub1ZhbHVlIjogIjAiLAogICAgICAgICAgInRocmVzaG9sZHMiOiB7CiAgICAgICAgICAgICJtb2RlIjogImFic29sdXRlIiwKICAgICAgICAgICAgInN0ZXBzIjogWwogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJjb2xvciI6ICJncmVlbiIsCiAgICAgICAgICAgICAgICAidmFsdWUiOiBudWxsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiY29sb3IiOiAicmVkIiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6IDgwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAib3ZlcnJpZGVzIjogWwogICAgICAgICAgewogICAgICAgICAgICAibWF0Y2hlciI6IHsKICAgICAgICAgICAgICAiaWQiOiAiYnlSZWdleHAiLAogICAgICAgICAgICAgICJvcHRpb25zIjogImJhdGNoIgogICAgICAgICAgICB9LAogICAgICAgICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiaWQiOiAiY29sb3IiLAogICAgICAgICAgICAgICAgInZhbHVlIjogewogICAgICAgICAgICAgICAgICAiZml4ZWRDb2xvciI6ICJncmVlbiIsCiAgICAgICAgICAgICAgICAgICJtb2RlIjogImZpeGVkIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgIm1hdGNoZXIiOiB7CiAgICAgICAgICAgICAgImlkIjogImJ5UmVnZXhwIiwKICAgICAgICAgICAgICAib3B0aW9ucyI6ICJwbGF0Zm9ybSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgImlkIjogImNvbG9yIiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHsKICAgICAgICAgICAgICAgICAgImZpeGVkQ29sb3IiOiAieWVsbG93IiwKICAgICAgICAgICAgICAgICAgIm1vZGUiOiAiZml4ZWQiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgICB9CiAgICAgICAgXQogICAgICB9LAogICAgICAiZ3JpZFBvcyI6IHsKICAgICAgICAiaCI6IDgsCiAgICAgICAgInciOiA3LAogICAgICAgICJ4IjogMTcsCiAgICAgICAgInkiOiAwCiAgICAgIH0sCiAgICAgICJpZCI6IDgsCiAgICAgICJvcHRpb25zIjogewogICAgICAgICJvcmllbnRhdGlvbiI6ICJhdXRvIiwKICAgICAgICAicmVkdWNlT3B0aW9ucyI6IHsKICAgICAgICAgICJjYWxjcyI6IFsKICAgICAgICAgICAgImxhc3QiCiAgICAgICAgICBdLAogICAgICAgICAgImZpZWxkcyI6ICIiLAogICAgICAgICAgInZhbHVlcyI6IGZhbHNlCiAgICAgICAgfSwKICAgICAgICAic2hvd1RocmVzaG9sZExhYmVscyI6IGZhbHNlLAogICAgICAgICJzaG93VGhyZXNob2xkTWFya2VycyI6IHRydWUsCiAgICAgICAgInRleHQiOiB7fQogICAgICB9LAogICAgICAicGx1Z2luVmVyc2lvbiI6ICI3LjQuMiIsCiAgICAgICJ0YXJnZXRzIjogWwogICAgICAgIHsKICAgICAgICAgICJleHByIjogImNvdW50IGJ5IChub2RlX2NsYXNzKSAobm9tYWRfY2xpZW50X3VwdGltZXtub2RlX3N0YXR1cz1cInJlYWR5XCJ9KSIsCiAgICAgICAgICAiaW50ZXJ2YWwiOiAiIiwKICAgICAgICAgICJsZWdlbmRGb3JtYXQiOiAie3tub2RlX2NsYXNzfX0iLAogICAgICAgICAgInJlZklkIjogIkEiCiAgICAgICAgfQogICAgICBdLAogICAgICAidGltZUZyb20iOiBudWxsLAogICAgICAidGltZVNoaWZ0IjogbnVsbCwKICAgICAgInRpdGxlIjogIkNsaWVudHMgcGVyIG5vZGUgY2xhc3MiLAogICAgICAidHlwZSI6ICJnYXVnZSIKICAgIH0sCiAgICB7CiAgICAgICJhbGlhc0NvbG9ycyI6IHt9LAogICAgICAiYmFycyI6IHRydWUsCiAgICAgICJkYXNoTGVuZ3RoIjogMTAsCiAgICAgICJkYXNoZXMiOiBmYWxzZSwKICAgICAgImRhdGFzb3VyY2UiOiBudWxsLAogICAgICAiZmllbGRDb25maWciOiB7CiAgICAgICAgImRlZmF1bHRzIjogewogICAgICAgICAgImN1c3RvbSI6IHt9CiAgICAgICAgfSwKICAgICAgICAib3ZlcnJpZGVzIjogW10KICAgICAgfSwKICAgICAgImZpbGwiOiAxMCwKICAgICAgImZpbGxHcmFkaWVudCI6IDAsCiAgICAgICJncmlkUG9zIjogewogICAgICAgICJoIjogOSwKICAgICAgICAidyI6IDEyLAogICAgICAgICJ4IjogMCwKICAgICAgICAieSI6IDgKICAgICAgfSwKICAgICAgImhpZGRlblNlcmllcyI6IGZhbHNlLAogICAgICAiaWQiOiAyLAogICAgICAibGVnZW5kIjogewogICAgICAgICJhdmciOiBmYWxzZSwKICAgICAgICAiY3VycmVudCI6IGZhbHNlLAogICAgICAgICJtYXgiOiBmYWxzZSwKICAgICAgICAibWluIjogZmFsc2UsCiAgICAgICAgInNob3ciOiB0cnVlLAogICAgICAgICJ0b3RhbCI6IGZhbHNlLAogICAgICAgICJ2YWx1ZXMiOiBmYWxzZQogICAgICB9LAogICAgICAibGluZXMiOiBmYWxzZSwKICAgICAgImxpbmV3aWR0aCI6IDAsCiAgICAgICJudWxsUG9pbnRNb2RlIjogIm51bGwiLAogICAgICAib3B0aW9ucyI6IHsKICAgICAgICAiYWxlcnRUaHJlc2hvbGQiOiB0cnVlCiAgICAgIH0sCiAgICAgICJwZXJjZW50YWdlIjogZmFsc2UsCiAgICAgICJwbHVnaW5WZXJzaW9uIjogIjcuNC4yIiwKICAgICAgInBvaW50cmFkaXVzIjogMiwKICAgICAgInBvaW50cyI6IGZhbHNlLAogICAgICAicmVuZGVyZXIiOiAiZmxvdCIsCiAgICAgICJzZXJpZXNPdmVycmlkZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIiQkaGFzaEtleSI6ICJvYmplY3Q6MTI1MyIsCiAgICAgICAgICAiYWxpYXMiOiAiY29tcGxldGUiLAogICAgICAgICAgImJhcnMiOiBmYWxzZSwKICAgICAgICAgICJmaWxsIjogMCwKICAgICAgICAgICJsaW5lcyI6IHRydWUsCiAgICAgICAgICAibGluZXdpZHRoIjogMSwKICAgICAgICAgICJzdGFjayI6IGZhbHNlLAogICAgICAgICAgInlheGlzIjogMgogICAgICAgIH0KICAgICAgXSwKICAgICAgInNwYWNlTGVuZ3RoIjogMTAsCiAgICAgICJzdGFjayI6IHRydWUsCiAgICAgICJzdGVwcGVkTGluZSI6IHRydWUsCiAgICAgICJ0YXJnZXRzIjogWwogICAgICAgIHsKICAgICAgICAgICJleHByIjogInN1bShub21hZF9ub21hZF9qb2Jfc3VtbWFyeV9ydW5uaW5ne2V4cG9ydGVkX2pvYj1+XCJiYXRjaC8uKlwifSkgT1Igb24oKSB2ZWN0b3IoMCkiLAogICAgICAgICAgImhpZGUiOiBmYWxzZSwKICAgICAgICAgICJpbnRlcnZhbCI6ICIiLAogICAgICAgICAgImxlZ2VuZEZvcm1hdCI6ICJydW5uaW5nIiwKICAgICAgICAgICJyZWZJZCI6ICJCIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgImV4cHIiOiAic3VtKG5vbWFkX25vbWFkX2pvYl9zdW1tYXJ5X3F1ZXVlZHtleHBvcnRlZF9qb2I9flwiYmF0Y2gvLipcIn0pIE9SIG9uKCkgdmVjdG9yKDApIiwKICAgICAgICAgICJoaWRlIjogZmFsc2UsCiAgICAgICAgICAiaW50ZXJ2YWwiOiAiIiwKICAgICAgICAgICJsZWdlbmRGb3JtYXQiOiAicXVldWVkIiwKICAgICAgICAgICJyZWZJZCI6ICJBIgogICAgICAgIH0KICAgICAgXSwKICAgICAgInRocmVzaG9sZHMiOiBbXSwKICAgICAgInRpbWVGcm9tIjogbnVsbCwKICAgICAgInRpbWVSZWdpb25zIjogW10sCiAgICAgICJ0aW1lU2hpZnQiOiBudWxsLAogICAgICAidGl0bGUiOiAiQmF0Y2ggam9icyBpbiBwcm9ncmVzcyIsCiAgICAgICJ0b29sdGlwIjogewogICAgICAgICJzaGFyZWQiOiB0cnVlLAogICAgICAgICJzb3J0IjogMCwKICAgICAgICAidmFsdWVfdHlwZSI6ICJpbmRpdmlkdWFsIgogICAgICB9LAogICAgICAidHlwZSI6ICJncmFwaCIsCiAgICAgICJ4YXhpcyI6IHsKICAgICAgICAiYnVja2V0cyI6IG51bGwsCiAgICAgICAgIm1vZGUiOiAidGltZSIsCiAgICAgICAgIm5hbWUiOiBudWxsLAogICAgICAgICJzaG93IjogdHJ1ZSwKICAgICAgICAidmFsdWVzIjogW10KICAgICAgfSwKICAgICAgInlheGVzIjogWwogICAgICAgIHsKICAgICAgICAgICIkJGhhc2hLZXkiOiAib2JqZWN0OjEzMyIsCiAgICAgICAgICAiZGVjaW1hbHMiOiAwLAogICAgICAgICAgImZvcm1hdCI6ICJub25lIiwKICAgICAgICAgICJsYWJlbCI6IG51bGwsCiAgICAgICAgICAibG9nQmFzZSI6IDEsCiAgICAgICAgICAibWF4IjogbnVsbCwKICAgICAgICAgICJtaW4iOiBudWxsLAogICAgICAgICAgInNob3ciOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiJCRoYXNoS2V5IjogIm9iamVjdDoxMzQiLAogICAgICAgICAgImZvcm1hdCI6ICJzaG9ydCIsCiAgICAgICAgICAibGFiZWwiOiBudWxsLAogICAgICAgICAgImxvZ0Jhc2UiOiAxLAogICAgICAgICAgIm1heCI6IG51bGwsCiAgICAgICAgICAibWluIjogbnVsbCwKICAgICAgICAgICJzaG93IjogdHJ1ZQogICAgICAgIH0KICAgICAgXSwKICAgICAgInlheGlzIjogewogICAgICAgICJhbGlnbiI6IGZhbHNlLAogICAgICAgICJhbGlnbkxldmVsIjogbnVsbAogICAgICB9CiAgICB9LAogICAgewogICAgICAiYWxpYXNDb2xvcnMiOiB7fSwKICAgICAgImJhcnMiOiBmYWxzZSwKICAgICAgImRhc2hMZW5ndGgiOiAxMCwKICAgICAgImRhc2hlcyI6IGZhbHNlLAogICAgICAiZGF0YXNvdXJjZSI6IG51bGwsCiAgICAgICJmaWVsZENvbmZpZyI6IHsKICAgICAgICAiZGVmYXVsdHMiOiB7CiAgICAgICAgICAiY3VzdG9tIjoge30KICAgICAgICB9LAogICAgICAgICJvdmVycmlkZXMiOiBbXQogICAgICB9LAogICAgICAiZmlsbCI6IDEsCiAgICAgICJmaWxsR3JhZGllbnQiOiAwLAogICAgICAiZ3JpZFBvcyI6IHsKICAgICAgICAiaCI6IDksCiAgICAgICAgInciOiAxMiwKICAgICAgICAieCI6IDEyLAogICAgICAgICJ5IjogOAogICAgICB9LAogICAgICAiaGlkZGVuU2VyaWVzIjogZmFsc2UsCiAgICAgICJpZCI6IDEwLAogICAgICAibGVnZW5kIjogewogICAgICAgICJhdmciOiBmYWxzZSwKICAgICAgICAiY3VycmVudCI6IGZhbHNlLAogICAgICAgICJtYXgiOiBmYWxzZSwKICAgICAgICAibWluIjogZmFsc2UsCiAgICAgICAgInNob3ciOiB0cnVlLAogICAgICAgICJ0b3RhbCI6IGZhbHNlLAogICAgICAgICJ2YWx1ZXMiOiBmYWxzZQogICAgICB9LAogICAgICAibGluZXMiOiB0cnVlLAogICAgICAibGluZXdpZHRoIjogMSwKICAgICAgIm51bGxQb2ludE1vZGUiOiAibnVsbCIsCiAgICAgICJvcHRpb25zIjogewogICAgICAgICJhbGVydFRocmVzaG9sZCI6IHRydWUKICAgICAgfSwKICAgICAgInBlcmNlbnRhZ2UiOiBmYWxzZSwKICAgICAgInBsdWdpblZlcnNpb24iOiAiNy40LjIiLAogICAgICAicG9pbnRyYWRpdXMiOiAyLAogICAgICAicG9pbnRzIjogZmFsc2UsCiAgICAgICJyZW5kZXJlciI6ICJmbG90IiwKICAgICAgInNlcmllc092ZXJyaWRlcyI6IFsKICAgICAgICB7CiAgICAgICAgICAiJCRoYXNoS2V5IjogIm9iamVjdDo5NiIsCiAgICAgICAgICAiYWxpYXMiOiAicGxhdGZvcm0iLAogICAgICAgICAgImNvbG9yIjogIiNGQURFMkEiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiJCRoYXNoS2V5IjogIm9iamVjdDoxMDQiLAogICAgICAgICAgImFsaWFzIjogImJhdGNoIiwKICAgICAgICAgICJjb2xvciI6ICIjNzNCRjY5IgogICAgICAgIH0KICAgICAgXSwKICAgICAgInNwYWNlTGVuZ3RoIjogMTAsCiAgICAgICJzdGFjayI6IGZhbHNlLAogICAgICAic3RlcHBlZExpbmUiOiB0cnVlLAogICAgICAidGFyZ2V0cyI6IFsKICAgICAgICB7CiAgICAgICAgICAiZXhwciI6ICJjb3VudCBieSAobm9kZV9jbGFzcykgKG5vbWFkX2NsaWVudF91cHRpbWV7bm9kZV9zdGF0dXM9XCJyZWFkeVwifSkiLAogICAgICAgICAgImluc3RhbnQiOiBmYWxzZSwKICAgICAgICAgICJpbnRlcnZhbCI6ICIiLAogICAgICAgICAgImludGVydmFsRmFjdG9yIjogMSwKICAgICAgICAgICJsZWdlbmRGb3JtYXQiOiAie3tub2RlX2NsYXNzfX0iLAogICAgICAgICAgInJlZklkIjogIkEiCiAgICAgICAgfQogICAgICBdLAogICAgICAidGhyZXNob2xkcyI6IFtdLAogICAgICAidGltZUZyb20iOiBudWxsLAogICAgICAidGltZVJlZ2lvbnMiOiBbXSwKICAgICAgInRpbWVTaGlmdCI6IG51bGwsCiAgICAgICJ0aXRsZSI6ICJOdW1iZXIgb2YgY2xpZW50cyIsCiAgICAgICJ0b29sdGlwIjogewogICAgICAgICJzaGFyZWQiOiB0cnVlLAogICAgICAgICJzb3J0IjogMCwKICAgICAgICAidmFsdWVfdHlwZSI6ICJpbmRpdmlkdWFsIgogICAgICB9LAogICAgICAidHlwZSI6ICJncmFwaCIsCiAgICAgICJ4YXhpcyI6IHsKICAgICAgICAiYnVja2V0cyI6IG51bGwsCiAgICAgICAgIm1vZGUiOiAidGltZSIsCiAgICAgICAgIm5hbWUiOiBudWxsLAogICAgICAgICJzaG93IjogdHJ1ZSwKICAgICAgICAidmFsdWVzIjogW10KICAgICAgfSwKICAgICAgInlheGVzIjogWwogICAgICAgIHsKICAgICAgICAgICIkJGhhc2hLZXkiOiAib2JqZWN0OjE1NzciLAogICAgICAgICAgImRlY2ltYWxzIjogMCwKICAgICAgICAgICJmb3JtYXQiOiAic2hvcnQiLAogICAgICAgICAgImxhYmVsIjogbnVsbCwKICAgICAgICAgICJsb2dCYXNlIjogMSwKICAgICAgICAgICJtYXgiOiBudWxsLAogICAgICAgICAgIm1pbiI6ICIwIiwKICAgICAgICAgICJzaG93IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIiQkaGFzaEtleSI6ICJvYmplY3Q6MTU3OCIsCiAgICAgICAgICAiZm9ybWF0IjogInNob3J0IiwKICAgICAgICAgICJsYWJlbCI6IG51bGwsCiAgICAgICAgICAibG9nQmFzZSI6IDEsCiAgICAgICAgICAibWF4IjogbnVsbCwKICAgICAgICAgICJtaW4iOiBudWxsLAogICAgICAgICAgInNob3ciOiB0cnVlCiAgICAgICAgfQogICAgICBdLAogICAgICAieWF4aXMiOiB7CiAgICAgICAgImFsaWduIjogZmFsc2UsCiAgICAgICAgImFsaWduTGV2ZWwiOiBudWxsCiAgICAgIH0KICAgIH0KICBdLAogICJyZWZyZXNoIjogIjVzIiwKICAic2NoZW1hVmVyc2lvbiI6IDI3LAogICJzdHlsZSI6ICJkYXJrIiwKICAidGFncyI6IFtdLAogICJ0ZW1wbGF0aW5nIjogewogICAgImxpc3QiOiBbXQogIH0sCiAgInRpbWUiOiB7CiAgICAiZnJvbSI6ICJub3ctMTVtIiwKICAgICJ0byI6ICJub3ciCiAgfSwKICAidGltZXBpY2tlciI6IHt9LAogICJ0aW1lem9uZSI6ICIiLAogICJ0aXRsZSI6ICJPbi1kZW1hbmQgYmF0Y2ggam9iIGRlbW8iLAogICJ1aWQiOiAiQ0psYzNyX01rIiwKICAidmVyc2lvbiI6IDEKfQo=",
            "filename": "../shared/terraform/modules/nomad-jobs/files/grafana_dashboard.json",
            "id": "c2585a313acb81035e2a4080d94b51be66311b15"
          }
        }
      ]
    },
    {
      "module": "module.nomad_jobs",
      "mode": "managed",
      "type": "nomad_job",
      "name": "batch",
      "provider": "provider[\"registry.terraform.io/hashicorp/nomad\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allocation_ids": [],
            "datacenters": [
              "dc1"
            ],
            "deployment_id": null,
            "deployment_status": null,
            "deregister_on_destroy": true,
            "deregister_on_id_change": true,
            "detach": true,
            "hcl2": [],
            "id": "batch",
            "jobspec": "job \"batch\" {\n  datacenters = [\"dc1\"]\n  type        = \"batch\"\n\n  parameterized {\n    meta_optional = [\"sleep\", \"splay\"]\n  }\n\n  meta {\n    sleep = \"180\"\n    splay = \"60\"\n  }\n\n  constraint {\n    attribute = \"${node.class}\"\n    value     = \"batch\"\n  }\n\n  group \"batch\" {\n    task \"sleep\" {\n      driver = \"docker\"\n\n      config {\n        image   = \"alpine:3.13\"\n        command = \"/bin/ash\"\n        args    = [\"${NOMAD_TASK_DIR}/sleep.sh\"]\n      }\n\n      template {\n        data = \u003c\u003cEOF\n#!/usr/bin/env bash\ndur=$((${NOMAD_META_sleep} + RANDOM % ${NOMAD_META_splay}))\necho \"Sleeping for ${dur}s\"\nsleep $dur\necho \"Done\"\n        EOF\n\n        destination = \"local/sleep.sh\"\n      }\n\n      resources {\n        cpu    = 100\n        memory = 1500\n      }\n    }\n  }\n}\n",
            "json": null,
            "modify_index": "12",
            "name": "batch",
            "namespace": "default",
            "policy_override": null,
            "purge_on_destroy": null,
            "region": "global",
            "task_groups": [
              {
                "count": 1,
                "meta": {},
                "name": "batch",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "sleep",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              }
            ],
            "timeouts": null,
            "type": "batch"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsInVwZGF0ZSI6MzAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.http.my_ip",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_elb.servers",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "module.nomad_jobs.null_resource.wait_for_nomad_api",
            "module.servers.aws_iam_instance_profile.servers",
            "module.servers.aws_iam_role.servers",
            "module.servers.aws_instance.servers",
            "module.servers.data.aws_iam_policy_document.assume",
            "module.servers.data.template_file.user_data",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.nomad_jobs",
      "mode": "managed",
      "type": "nomad_job",
      "name": "grafana",
      "provider": "provider[\"registry.terraform.io/hashicorp/nomad\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allocation_ids": [
              "aac6e2bf-9eec-555d-7337-178aae1223c3",
              "ee700662-b2ff-cc24-2e79-a088c32abb20"
            ],
            "datacenters": [
              "dc1"
            ],
            "deployment_id": null,
            "deployment_status": null,
            "deregister_on_destroy": true,
            "deregister_on_id_change": true,
            "detach": true,
            "hcl2": [],
            "id": "grafana",
            "jobspec": "job \"grafana\" {\n  datacenters = [\"dc1\"]\n\n  constraint {\n    attribute = \"${node.class}\"\n    value     = \"platform\"\n  }\n\n  group \"grafana\" {\n    network {\n      port \"grafana_ui\" {}\n    }\n\n    task \"grafana\" {\n      driver = \"docker\"\n\n      config {\n        image = \"grafana/grafana:7.4.2\"\n        ports = [\"grafana_ui\"]\n\n        volumes = [\n          \"local/datasources:/etc/grafana/provisioning/datasources\",\n          \"local/dashboards:/etc/grafana/provisioning/dashboards\",\n          \"local/dashboard.json:/var/lib/grafana/dashboards/default/dashboard.json\",\n        ]\n      }\n\n      env {\n        GF_AUTH_ANONYMOUS_ENABLED  = \"true\"\n        GF_AUTH_ANONYMOUS_ORG_ROLE = \"Editor\"\n        GF_SERVER_HTTP_PORT        = \"${NOMAD_PORT_grafana_ui}\"\n      }\n\n      template {\n        data = \u003c\u003cEOH\napiVersion: 1\ndatasources:\n- name: Prometheus\n  type: prometheus\n  access: proxy\n  url: http://{{ range $i, $s := service \"prometheus\" }}{{ if eq $i 0 }}{{.Address}}:{{.Port}}{{end}}{{end}}\n  isDefault: true\n  version: 1\n  editable: false\nEOH\n\n        destination = \"local/datasources/prometheus.yaml\"\n      }\n\n      template {\n        data = \u003c\u003cEOH\napiVersion: 1\ndatasources:\n- name: Loki\n  type: loki\n  access: proxy\n  url: http://{{ range $i, $s := service \"loki\" }}{{ if eq $i 0 }}{{.Address}}:{{.Port}}{{end}}{{end}}\n  isDefault: false\n  version: 1\n  editable: false\nEOH\n\n        destination = \"local/datasources/loki.yaml\"\n      }\n\n      template {\n        data = \u003c\u003cEOH\napiVersion: 1\n\nproviders:\n- name: Nomad Autoscaler\n  folder: Nomad Autoscaler Demos\n  folderUid: nomad\n  type: file\n  disableDeletion: true\n  editable: false\n  allowUiUpdates: false\n  options:\n    path: /var/lib/grafana/dashboards\nEOH\n\n        destination = \"local/dashboards/nomad-autoscaler.yaml\"\n      }\n\n      template {\n        left_delimiter  = \"%%\"\n        right_delimiter = \"%%\"\n\n        data        = \u003c\u003cEOF\n{\n  \"annotations\": {\n    \"list\": [\n      {\n        \"builtIn\": 1,\n        \"datasource\": \"-- Grafana --\",\n        \"enable\": true,\n        \"hide\": true,\n        \"iconColor\": \"rgba(0, 211, 255, 1)\",\n        \"limit\": 100,\n        \"name\": \"Annotations \u0026 Alerts\",\n        \"showIn\": 0,\n        \"type\": \"dashboard\"\n      },\n      {\n        \"datasource\": \"Loki\",\n        \"enable\": true,\n        \"expr\": \"{task=\\\"autoscaler\\\"} |= \\\"scaling target\\\" | logfmt | line_format \\\"{{.reason}}\\\"\",\n        \"hide\": false,\n        \"iconColor\": \"#5794F2\",\n        \"name\": \"Autoscaler\",\n        \"showIn\": 0,\n        \"target\": {}\n      }\n    ]\n  },\n  \"editable\": true,\n  \"gnetId\": null,\n  \"graphTooltip\": 0,\n  \"links\": [],\n  \"panels\": [\n    {\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {\n          \"color\": {\n            \"fixedColor\": \"green\",\n            \"mode\": \"palette-classic\"\n          },\n          \"custom\": {},\n          \"mappings\": [],\n          \"thresholds\": {\n            \"mode\": \"absolute\",\n            \"steps\": [\n              {\n                \"color\": \"green\",\n                \"value\": null\n              },\n              {\n                \"color\": \"red\",\n                \"value\": 80\n              }\n            ]\n          }\n        },\n        \"overrides\": [\n          {\n            \"matcher\": {\n              \"id\": \"byName\",\n              \"options\": \"complete\"\n            },\n            \"properties\": [\n              {\n                \"id\": \"color\",\n                \"value\": {\n                  \"fixedColor\": \"green\",\n                  \"mode\": \"fixed\"\n                }\n              }\n            ]\n          },\n          {\n            \"matcher\": {\n              \"id\": \"byName\",\n              \"options\": \"failed\"\n            },\n            \"properties\": [\n              {\n                \"id\": \"color\",\n                \"value\": {\n                  \"fixedColor\": \"red\",\n                  \"mode\": \"fixed\"\n                }\n              }\n            ]\n          }\n        ]\n      },\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 17,\n        \"x\": 0,\n        \"y\": 0\n      },\n      \"id\": 14,\n      \"options\": {\n        \"reduceOptions\": {\n          \"calcs\": [\n            \"lastNotNull\"\n          ],\n          \"fields\": \"\",\n          \"values\": false\n        },\n        \"showThresholdLabels\": false,\n        \"showThresholdMarkers\": true,\n        \"text\": {}\n      },\n      \"pluginVersion\": \"7.4.2\",\n      \"targets\": [\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_queued{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"interval\": \"\",\n          \"legendFormat\": \"queued\",\n          \"refId\": \"A\"\n        },\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_running{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"running\",\n          \"refId\": \"B\"\n        },\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_complete{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"complete\",\n          \"refId\": \"C\"\n        },\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_failed{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"failed\",\n          \"refId\": \"D\"\n        }\n      ],\n      \"title\": \"Batch job count per status\",\n      \"type\": \"gauge\"\n    },\n    {\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {\n          \"color\": {\n            \"mode\": \"palette-classic\"\n          },\n          \"custom\": {},\n          \"decimals\": 0,\n          \"mappings\": [],\n          \"max\": 5,\n          \"min\": 0,\n          \"noValue\": \"0\",\n          \"thresholds\": {\n            \"mode\": \"absolute\",\n            \"steps\": [\n              {\n                \"color\": \"green\",\n                \"value\": null\n              },\n              {\n                \"color\": \"red\",\n                \"value\": 80\n              }\n            ]\n          }\n        },\n        \"overrides\": [\n          {\n            \"matcher\": {\n              \"id\": \"byRegexp\",\n              \"options\": \"batch\"\n            },\n            \"properties\": [\n              {\n                \"id\": \"color\",\n                \"value\": {\n                  \"fixedColor\": \"green\",\n                  \"mode\": \"fixed\"\n                }\n              }\n            ]\n          },\n          {\n            \"matcher\": {\n              \"id\": \"byRegexp\",\n              \"options\": \"platform\"\n            },\n            \"properties\": [\n              {\n                \"id\": \"color\",\n                \"value\": {\n                  \"fixedColor\": \"yellow\",\n                  \"mode\": \"fixed\"\n                }\n              }\n            ]\n          }\n        ]\n      },\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 7,\n        \"x\": 17,\n        \"y\": 0\n      },\n      \"id\": 8,\n      \"options\": {\n        \"orientation\": \"auto\",\n        \"reduceOptions\": {\n          \"calcs\": [\n            \"last\"\n          ],\n          \"fields\": \"\",\n          \"values\": false\n        },\n        \"showThresholdLabels\": false,\n        \"showThresholdMarkers\": true,\n        \"text\": {}\n      },\n      \"pluginVersion\": \"7.4.2\",\n      \"targets\": [\n        {\n          \"expr\": \"count by (node_class) (nomad_client_uptime{node_status=\\\"ready\\\"})\",\n          \"interval\": \"\",\n          \"legendFormat\": \"{{node_class}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"timeFrom\": null,\n      \"timeShift\": null,\n      \"title\": \"Clients per node class\",\n      \"type\": \"gauge\"\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": true,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {\n          \"custom\": {}\n        },\n        \"overrides\": []\n      },\n      \"fill\": 10,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 8\n      },\n      \"hiddenSeries\": false,\n      \"id\": 2,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": false,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\": false,\n      \"linewidth\": 0,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.4.2\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [\n        {\n          \"$$hashKey\": \"object:1253\",\n          \"alias\": \"complete\",\n          \"bars\": false,\n          \"fill\": 0,\n          \"lines\": true,\n          \"linewidth\": 1,\n          \"stack\": false,\n          \"yaxis\": 2\n        }\n      ],\n      \"spaceLength\": 10,\n      \"stack\": true,\n      \"steppedLine\": true,\n      \"targets\": [\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_running{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"running\",\n          \"refId\": \"B\"\n        },\n        {\n          \"expr\": \"sum(nomad_nomad_job_summary_queued{exported_job=~\\\"batch/.*\\\"}) OR on() vector(0)\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"queued\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Batch jobs in progress\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:133\",\n          \"decimals\": 0,\n          \"format\": \"none\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:134\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {\n          \"custom\": {}\n        },\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 8\n      },\n      \"hiddenSeries\": false,\n      \"id\": 10,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": false,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.4.2\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [\n        {\n          \"$$hashKey\": \"object:96\",\n          \"alias\": \"platform\",\n          \"color\": \"#FADE2A\"\n        },\n        {\n          \"$$hashKey\": \"object:104\",\n          \"alias\": \"batch\",\n          \"color\": \"#73BF69\"\n        }\n      ],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": true,\n      \"targets\": [\n        {\n          \"expr\": \"count by (node_class) (nomad_client_uptime{node_status=\\\"ready\\\"})\",\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{node_class}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Number of clients\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1577\",\n          \"decimals\": 0,\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": \"0\",\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1578\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    }\n  ],\n  \"refresh\": \"5s\",\n  \"schemaVersion\": 27,\n  \"style\": \"dark\",\n  \"tags\": [],\n  \"templating\": {\n    \"list\": []\n  },\n  \"time\": {\n    \"from\": \"now-15m\",\n    \"to\": \"now\"\n  },\n  \"timepicker\": {},\n  \"timezone\": \"\",\n  \"title\": \"On-demand batch job demo\",\n  \"uid\": \"CJlc3r_Mk\",\n  \"version\": 1\n}\n\nEOF\n        destination = \"local/dashboard.json\"\n      }\n\n      resources {\n        cpu    = 100\n        memory = 64\n      }\n\n      service {\n        name = \"grafana\"\n        port = \"grafana_ui\"\n\n        tags = [\n          \"traefik.enable=true\",\n          \"traefik.tcp.routers.grafana.entrypoints=grafana\",\n          \"traefik.tcp.routers.grafana.rule=HostSNI(`*`)\"\n        ]\n\n        check {\n          type     = \"http\"\n          path     = \"/api/health\"\n          interval = \"10s\"\n          timeout  = \"2s\"\n        }\n      }\n    }\n  }\n\n  group \"loki\" {\n    network {\n      port \"loki\" {}\n    }\n\n    task \"loki\" {\n      driver = \"docker\"\n\n      config {\n        image = \"grafana/loki:2.1.0\"\n        args  = [\"--config.file=${NOMAD_TASK_DIR}/loki.yml\"]\n        ports = [\"loki\"]\n      }\n\n      template {\n        data = \u003c\u003cEOH\n---\nauth_enabled: false\n\nserver:\n  http_listen_port: {{ env \"NOMAD_PORT_loki\" }}\n\ningester:\n  lifecycler:\n    address: 127.0.0.1\n    ring:\n      kvstore:\n        store: inmemory\n      replication_factor: 1\n    final_sleep: 0s\n  chunk_idle_period: 5m\n  chunk_retain_period: 30s\n\nschema_config:\n  configs:\n  - from: 2020-05-15\n    store: boltdb\n    object_store: filesystem\n    schema: v11\n    index:\n      prefix: index_\n      period: 168h\n\nstorage_config:\n  boltdb:\n    directory: /tmp/loki/index\n\n  filesystem:\n    directory: /tmp/loki/chunks\n\nlimits_config:\n  enforce_metric_name: false\n  reject_old_samples: true\n  reject_old_samples_max_age: 168h\nEOH\n\n        change_mode   = \"signal\"\n        change_signal = \"SIGHUP\"\n        destination   = \"local/loki.yml\"\n      }\n\n      resources {\n        cpu    = 100\n        memory = 256\n      }\n\n      service {\n        name = \"loki\"\n        port = \"loki\"\n\n        check {\n          type     = \"http\"\n          path     = \"/ready\"\n          interval = \"10s\"\n          timeout  = \"2s\"\n        }\n      }\n    }\n  }\n}\n",
            "json": null,
            "modify_index": "17",
            "name": "grafana",
            "namespace": "default",
            "policy_override": null,
            "purge_on_destroy": null,
            "region": "global",
            "task_groups": [
              {
                "count": 1,
                "meta": {},
                "name": "grafana",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "grafana",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              },
              {
                "count": 1,
                "meta": {},
                "name": "loki",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "loki",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              }
            ],
            "timeouts": null,
            "type": "service"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsInVwZGF0ZSI6MzAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.http.my_ip",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_elb.servers",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "module.nomad_jobs.data.local_file.grafana_dashboard",
            "module.nomad_jobs.null_resource.wait_for_nomad_api",
            "module.servers.aws_iam_instance_profile.servers",
            "module.servers.aws_iam_role.servers",
            "module.servers.aws_instance.servers",
            "module.servers.data.aws_iam_policy_document.assume",
            "module.servers.data.template_file.user_data",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.nomad_jobs",
      "mode": "managed",
      "type": "nomad_job",
      "name": "prometheus",
      "provider": "provider[\"registry.terraform.io/hashicorp/nomad\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allocation_ids": [
              "19382ea5-de07-795b-d5c5-3e199c0ba250"
            ],
            "datacenters": [
              "dc1"
            ],
            "deployment_id": null,
            "deployment_status": null,
            "deregister_on_destroy": true,
            "deregister_on_id_change": true,
            "detach": true,
            "hcl2": [],
            "id": "prometheus",
            "jobspec": "job \"prometheus\" {\n  datacenters = [\"dc1\"]\n\n  constraint {\n    attribute = \"${node.class}\"\n    value     = \"platform\"\n  }\n\n  group \"prometheus\" {\n    network {\n      port \"prometheus_ui\" {}\n    }\n\n    task \"prometheus\" {\n      driver = \"docker\"\n\n      config {\n        image = \"prom/prometheus:v2.25.0\"\n        ports = [\"prometheus_ui\"]\n\n        args = [\n          \"--config.file=${NOMAD_TASK_DIR}/prometheus.yml\",\n          \"--storage.tsdb.path=/prometheus\",\n          \"--web.listen-address=0.0.0.0:${NOMAD_PORT_prometheus_ui}\",\n          \"--web.console.libraries=/usr/share/prometheus/console_libraries\",\n          \"--web.console.templates=/usr/share/prometheus/consoles\",\n        ]\n      }\n\n      template {\n        data = \u003c\u003cEOH\n---\nglobal:\n  scrape_interval:     1s\n  evaluation_interval: 1s\n\nscrape_configs:\n  - job_name: nomad\n    scrape_interval: 10s\n    metrics_path: /v1/metrics\n    params:\n      format: ['prometheus']\n    consul_sd_configs:\n    - server: '{{ env \"attr.unique.network.ip-address\" }}:8500'\n      services: ['nomad','nomad-client']\n    relabel_configs:\n      - source_labels: ['__meta_consul_tags']\n        regex: .*,http,.*\n        action: keep\nEOH\n\n        change_mode   = \"signal\"\n        change_signal = \"SIGHUP\"\n        destination   = \"local/prometheus.yml\"\n      }\n\n      resources {\n        cpu    = 100\n        memory = 256\n      }\n\n      service {\n        name = \"prometheus\"\n        port = \"prometheus_ui\"\n\n        tags = [\n          \"traefik.enable=true\",\n          \"traefik.tcp.routers.prometheus.entrypoints=prometheus\",\n          \"traefik.tcp.routers.prometheus.rule=HostSNI(`*`)\"\n        ]\n\n        check {\n          type     = \"http\"\n          path     = \"/-/healthy\"\n          interval = \"10s\"\n          timeout  = \"2s\"\n        }\n      }\n    }\n  }\n}\n",
            "json": null,
            "modify_index": "10",
            "name": "prometheus",
            "namespace": "default",
            "policy_override": null,
            "purge_on_destroy": null,
            "region": "global",
            "task_groups": [
              {
                "count": 1,
                "meta": {},
                "name": "prometheus",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "prometheus",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              }
            ],
            "timeouts": null,
            "type": "service"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsInVwZGF0ZSI6MzAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.http.my_ip",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_elb.servers",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "module.nomad_jobs.null_resource.wait_for_nomad_api",
            "module.servers.aws_iam_instance_profile.servers",
            "module.servers.aws_iam_role.servers",
            "module.servers.aws_instance.servers",
            "module.servers.data.aws_iam_policy_document.assume",
            "module.servers.data.template_file.user_data",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.nomad_jobs",
      "mode": "managed",
      "type": "nomad_job",
      "name": "traefik",
      "provider": "provider[\"registry.terraform.io/hashicorp/nomad\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allocation_ids": [
              "76a738fe-bc1b-fa48-2994-01eb9c8c739f"
            ],
            "datacenters": [
              "dc1"
            ],
            "deployment_id": null,
            "deployment_status": null,
            "deregister_on_destroy": true,
            "deregister_on_id_change": true,
            "detach": true,
            "hcl2": [],
            "id": "traefik",
            "jobspec": "job \"traefik\" {\n  datacenters = [\"dc1\"]\n  type        = \"system\"\n\n  constraint {\n    attribute = \"${node.class}\"\n    value     = \"platform\"\n  }\n\n  group \"traefik\" {\n    network {\n      port \"api\" {\n        static = 8081\n      }\n\n      port \"grafana\" {\n        static = 3000\n      }\n\n      port \"prometheus\" {\n        static = 9090\n      }\n    }\n\n    task \"traefik\" {\n      driver = \"docker\"\n\n      config {\n        image = \"traefik:v2.2\"\n        ports = [\"api\", \"grafana\", \"prometheus\"]\n\n        volumes = [\n          \"local/traefik.toml:/etc/traefik/traefik.toml\",\n        ]\n      }\n\n      template {\n        data = \u003c\u003cEOF\n[entryPoints]\n  [entryPoints.traefik]\n    address = \":{{ env \"NOMAD_PORT_api\" }}\"\n\n  [entryPoints.grafana]\n    address = \":{{ env \"NOMAD_PORT_grafana\" }}\"\n\n  [entryPoints.prometheus]\n    address = \":{{ env \"NOMAD_PORT_prometheus\" }}\"\n\n[api]\n  dashboard = true\n  insecure  = true\n\n[metrics]\n  [metrics.prometheus]\n    addServicesLabels = true\n\n# Enable Consul Catalog configuration backend.\n[providers.consulCatalog]\n  prefix           = \"traefik\"\n  exposedByDefault = false\n\n  [providers.consulCatalog.endpoint]\n    address = \"{{ env \"attr.unique.network.ip-address\" }}:8500\"\n    scheme  = \"http\"\nEOF\n\n        destination = \"local/traefik.toml\"\n      }\n\n      resources {\n        cpu    = 200\n        memory = 256\n      }\n\n      service {\n        name         = \"traefik-api\"\n        port         = \"api\"\n        address_mode = \"host\"\n\n        check {\n          name     = \"alive\"\n          type     = \"tcp\"\n          port     = \"api\"\n          interval = \"10s\"\n          timeout  = \"2s\"\n        }\n      }\n\n      service {\n        name         = \"traefik-grafana\"\n        port         = \"grafana\"\n        address_mode = \"host\"\n\n        check {\n          name     = \"alive\"\n          type     = \"tcp\"\n          port     = \"grafana\"\n          interval = \"10s\"\n          timeout  = \"2s\"\n        }\n      }\n\n      service {\n        name         = \"traefik-prometheus\"\n        port         = \"prometheus\"\n        address_mode = \"host\"\n\n        check {\n          name     = \"alive\"\n          type     = \"tcp\"\n          port     = \"prometheus\"\n          interval = \"10s\"\n          timeout  = \"2s\"\n        }\n      }\n    }\n  }\n}\n",
            "json": null,
            "modify_index": "11",
            "name": "traefik",
            "namespace": "default",
            "policy_override": null,
            "purge_on_destroy": null,
            "region": "global",
            "task_groups": [
              {
                "count": 1,
                "meta": {},
                "name": "traefik",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "traefik",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              }
            ],
            "timeouts": null,
            "type": "system"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsInVwZGF0ZSI6MzAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.http.my_ip",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_elb.servers",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "module.nomad_jobs.null_resource.wait_for_nomad_api",
            "module.servers.aws_iam_instance_profile.servers",
            "module.servers.aws_iam_role.servers",
            "module.servers.aws_instance.servers",
            "module.servers.data.aws_iam_policy_document.assume",
            "module.servers.data.template_file.user_data",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.nomad_jobs",
      "mode": "managed",
      "type": "null_resource",
      "name": "wait_for_nomad_api",
      "provider": "provider[\"registry.terraform.io/hashicorp/null\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "3428378389469046593",
            "triggers": null
          },
          "private": "bnVsbA==",
          "dependencies": [
            "data.http.my_ip",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_elb.servers",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "module.servers.aws_iam_instance_profile.servers",
            "module.servers.aws_iam_role.servers",
            "module.servers.aws_instance.servers",
            "module.servers.data.aws_iam_policy_document.assume",
            "module.servers.data.template_file.user_data",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.servers",
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "assume",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "1903849331",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "sts:AssumeRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "ec2.amazonaws.com"
                    ],
                    "type": "Service"
                  }
                ],
                "resources": [],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "module": "module.servers",
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "servers",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "2069168386",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:DescribeTags\",\n        \"ec2:DescribeInstances\",\n        \"autoscaling:DescribeAutoScalingGroups\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "autoscaling:DescribeAutoScalingGroups",
                  "ec2:DescribeInstances",
                  "ec2:DescribeTags"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "*"
                ],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "module": "module.servers",
      "mode": "data",
      "type": "template_file",
      "name": "user_data",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "86b06de45ee6469e84493aeb7ec3814c097749bd38b56c6f251320704f19a577",
            "rendered": "#!/bin/bash\n\nset -e\n\nexec \u003e \u003e(sudo tee /var/log/user-data.log|logger -t user-data -s 2\u003e/dev/console) 2\u003e\u00261\nsudo chmod +x /ops/scripts/server.sh\nsudo bash -c \"NOMAD_BINARY= CONSUL_BINARY=  /ops/scripts/server.sh \\\"aws\\\" \\\"1\\\" \\\"provider=aws tag_key=ConsulAutoJoin tag_value=auto-join\\\"\"\nrm -rf /ops/\n",
            "template": "#!/bin/bash\n\nset -e\n\nexec \u003e \u003e(sudo tee /var/log/user-data.log|logger -t user-data -s 2\u003e/dev/console) 2\u003e\u00261\nsudo chmod +x /ops/scripts/server.sh\nsudo bash -c \"NOMAD_BINARY=${nomad_binary} CONSUL_BINARY=${consul_binary}  /ops/scripts/server.sh \\\"aws\\\" \\\"${server_count}\\\" \\\"${retry_join}\\\"\"\nrm -rf /ops/\n",
            "vars": {
              "consul_binary": "",
              "nomad_binary": "",
              "retry_join": "provider=aws tag_key=ConsulAutoJoin tag_value=auto-join",
              "server_count": "1"
            }
          }
        }
      ]
    },
    {
      "module": "module.servers",
      "mode": "managed",
      "type": "aws_iam_instance_profile",
      "name": "servers",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::267023797923:instance-profile/set-squirrel20210702062758608300000009",
            "create_date": "2021-07-02T06:27:59Z",
            "id": "set-squirrel20210702062758608300000009",
            "name": "set-squirrel20210702062758608300000009",
            "name_prefix": "set-squirrel",
            "path": "/",
            "role": "set-squirrel-servers20210702062757701400000002",
            "roles": [],
            "unique_id": "AIPAT4K63Z2RS4XBYRGSN"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "module.servers.aws_iam_role.servers",
            "module.servers.data.aws_iam_policy_document.assume",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.servers",
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "servers",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::267023797923:role/set-squirrel-servers20210702062757701400000002",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2021-07-02T06:27:58Z",
            "description": "",
            "force_detach_policies": false,
            "id": "set-squirrel-servers20210702062757701400000002",
            "max_session_duration": 3600,
            "name": "set-squirrel-servers20210702062757701400000002",
            "name_prefix": "set-squirrel-servers",
            "path": "/",
            "permissions_boundary": null,
            "tags": {
              "OwnerEmail": "lvandyke@hashicorp.com",
              "OwnerName": "lvandyke"
            },
            "unique_id": "AROAT4K63Z2R5MAEBCJGP"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "module.servers.data.aws_iam_policy_document.assume",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.servers",
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "servers",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "set-squirrel-servers20210702062757701400000002:set-squirrel20210702062758608000000007",
            "name": "set-squirrel20210702062758608000000007",
            "name_prefix": "set-squirrel",
            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:DescribeTags\",\n        \"ec2:DescribeInstances\",\n        \"autoscaling:DescribeAutoScalingGroups\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}",
            "role": "set-squirrel-servers20210702062757701400000002"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "module.servers.aws_iam_role.servers",
            "module.servers.data.aws_iam_policy_document.assume",
            "module.servers.data.aws_iam_policy_document.servers",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    },
    {
      "module": "module.servers",
      "mode": "managed",
      "type": "aws_instance",
      "name": "servers",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "ami": "ami-077713ca5adbc0928",
            "arn": "arn:aws:ec2:us-east-1:267023797923:instance/i-08823b924ebcbd248",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1a",
            "cpu_core_count": 1,
            "cpu_threads_per_core": 2,
            "credit_specification": [
              {
                "cpu_credits": "unlimited"
              }
            ],
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "ephemeral_block_device": [],
            "get_password_data": false,
            "hibernation": false,
            "host_id": null,
            "iam_instance_profile": "set-squirrel20210702062758608300000009",
            "id": "i-08823b924ebcbd248",
            "instance_initiated_shutdown_behavior": null,
            "instance_state": "running",
            "instance_type": "t3.small",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "lvd-nomad",
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_put_response_hop_limit": 1,
                "http_tokens": "optional"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "network_interface_id": null,
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "primary_network_interface_id": "eni-05772a28863070a91",
            "private_dns": "ip-172-31-20-34.ec2.internal",
            "private_ip": "172.31.20.34",
            "public_dns": "ec2-18-212-227-141.compute-1.amazonaws.com",
            "public_ip": "18.212.227.141",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/sda1",
                "encrypted": false,
                "iops": 100,
                "kms_key_id": "",
                "volume_id": "vol-0246417cdf7a4802a",
                "volume_size": 16,
                "volume_type": "gp2"
              }
            ],
            "security_groups": [
              "set-squirrel-agents2021070206280466060000000d"
            ],
            "source_dest_check": true,
            "subnet_id": "subnet-fc1e8cb1",
            "tags": {
              "ConsulAutoJoin": "auto-join",
              "Name": "set-squirrel-server-1",
              "OwnerEmail": "lvandyke@hashicorp.com",
              "OwnerName": "lvandyke"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "9d5f6609164b1804721a9677ebf12034fbd30819",
            "user_data_base64": null,
            "volume_tags": {},
            "vpc_security_group_ids": [
              "sg-0434be26599f100cb"
            ]
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "data.http.my_ip",
            "module.image.data.aws_ami.built",
            "module.image.data.aws_ami.existing",
            "module.image.null_resource.packer_build",
            "module.network.aws_security_group.agents",
            "module.network.aws_security_group.servers_lb",
            "module.network.data.aws_vpc.default",
            "module.servers.aws_iam_instance_profile.servers",
            "module.servers.aws_iam_role.servers",
            "module.servers.data.aws_iam_policy_document.assume",
            "module.servers.data.template_file.user_data",
            "null_resource.preflight_check",
            "random_pet.stack_name"
          ]
        }
      ]
    }
  ]
}
